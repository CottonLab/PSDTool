!function e(t,i,n){function r(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,i){"use strict";function n(e,t,i){return 77*e+151*t+28*i>>8}function r(e,t,i,r){return r-=n(e,t,i),a(e+r,t+r,i+r)}function a(e,t,i){var r=n(e,t,i),a=Math.min(e,t,i),o=Math.max(e,t,i);return 0>a&&(e=r+(e-r)*r/(r-a),t=r+(t-r)*r/(r-a),i=r+(i-r)*r/(r-a)),o>255&&(e=r+(e-r)*(255-r)/(o-r),t=r+(t-r)*(255-r)/(o-r),i=r+(i-r)*(255-r)/(o-r)),e<<16|t<<8|i}function o(e,t,i){return Math.max(e,t,i)-Math.min(e,t,i)}function s(e,t,i,n){return t>=e?i>=t?l(e,t,i,n):i>=e?(n=l(e,i,t,n),16711680&n|(255&n)<<8|(65280&n)>>8):(n=l(i,e,t,n),(65535&n)<<8|(16711680&n)>>16):i>=e?(n=l(t,e,i,n),(65280&n)<<8|(16711680&n)>>8|255&n):i>=t?(n=l(t,i,e,n),(255&n)<<16|(16776960&n)>>8):(n=l(i,t,e,n),(255&n)<<16|65280&n|(16711680&n)>>16)}function l(e,t,i,n){return i>e?(t-e)*n/(i-e)<<8|n:0}function d(e,t,i,n,r){for(var a=0,o=i*n<<2;o>a;a+=4)e[a+3]=t[a+3]*r}function c(e,t,i,n,r){for(var a=255*r,o=0,s=i*n<<2;s>o;o+=4)e[o+0]=t[o+0],e[o+1]=t[o+1],e[o+2]=t[o+2],e[o+3]=a}function h(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=a,g=o,y=s,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function u(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=d>a?a:d,g=c>o?o:c,y=h>s?s:h,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function f(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=a*d*32897>>23,g=o*c*32897>>23,y=s*h*32897>>23,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function p(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=255===d?255:0===a?0:255-Math.min(255,(255-d)/a*255),g=255===c?255:0===o?0:255-Math.min(255,(255-c)/o*255),y=255===h?255:0===s?0:255-Math.min(255,(255-h)/s*255),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function m(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=Math.max(0,d+a-255),g=Math.max(0,c+o-255),y=Math.max(0,h+s-255),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function v(e,t,i,r,a){for(var o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x,k=0,S=i*r<<2;S>k;k+=4)o=t[k],s=t[k+1],l=t[k+2],d=t[k+3],c=e[k],h=e[k+1],u=e[k+2],f=e[k+3],x=0|d*a*32897,p=x*f>>23,m=x*(255-f)>>23,v=(8388735-x)*f>>23,b=p+m+v,e[k+3]=b,b&&(n(o,s,l)<n(c,h,u)?(g=o,y=s,w=l):(g=c,y=h,w=u),e[k]=(g*p+o*m+c*v)/b,e[k+1]=(y*p+s*m+h*v)/b,e[k+2]=(w*p+l*m+u*v)/b)}function g(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=a>d?a:d,g=o>c?o:c,y=s>h?s:h,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function y(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=a+d-(a*d*32897>>23),g=o+c-(o*c*32897>>23),y=s+h-(s*h*32897>>23),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function w(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=0===d?0:255===a?255:Math.min(255,255*d/(255-a)),g=0===c?0:255===o?255:Math.min(255,255*c/(255-o)),y=0===h?0:255===s?255:Math.min(255,255*h/(255-s)),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function b(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=a+d,g=o+c,y=s+h,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function x(e,t,i,r,a){for(var o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x,k=0,S=i*r<<2;S>k;k+=4)o=t[k],s=t[k+1],l=t[k+2],d=t[k+3],c=e[k],h=e[k+1],u=e[k+2],f=e[k+3],x=0|d*a*32897,p=x*f>>23,m=x*(255-f)>>23,v=(8388735-x)*f>>23,b=p+m+v,e[k+3]=b,b&&(n(o,s,l)>n(c,h,u)?(g=o,y=s,w=l):(g=c,y=h,w=u),e[k]=(g*p+o*m+c*v)/b,e[k+1]=(y*p+s*m+h*v)/b,e[k+2]=(w*p+l*m+u*v)/b)}function k(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=128>d?a*d*32897>>22:255-((255-(d-128<<1))*(255-a)*32897>>23),g=128>c?o*c*32897>>22:255-((255-(c-128<<1))*(255-o)*32897>>23),y=128>h?s*h*32897>>22:255-((255-(h-128<<1))*(255-s)*32897>>23),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function S(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(128>a?v=d-(((255-(a<<1))*d*32897>>23)*(255-d)*32897>>23):(b=64>d?((32897*((d<<4)-3060)>>23)*d+1020)*d*32897>>23:255*Math.sqrt(d/255),v=d+(((a<<1)-255)*(b-d)*32897>>23)),128>o?g=c-(((255-(o<<1))*c*32897>>23)*(255-c)*32897>>23):(b=64>c?((32897*((c<<4)-3060)>>23)*c+1020)*c*32897>>23:255*Math.sqrt(c/255),g=c+(((o<<1)-255)*(b-c)*32897>>23)),128>s?y=h-(((255-(s<<1))*h*32897>>23)*(255-h)*32897>>23):(b=64>h?((32897*((h<<4)-3060)>>23)*h+1020)*h*32897>>23:255*Math.sqrt(h/255),y=h+(((s<<1)-255)*(b-h)*32897>>23)),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function E(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(128>a?v=d*a*32897>>22:(b=(a<<1)-255,v=d+b-(d*b*32897>>23)),128>o?g=c*o*32897>>22:(b=(o<<1)-255,g=c+b-(c*b*32897>>23)),128>s?y=h*s*32897>>22:(b=(s<<1)-255,y=h+b-(h*b*32897>>23)),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function A(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(128>a?(b=a<<1,v=0===a?b:Math.max(0,255-255*(255-d)/b)):(b=(a-128<<1)+1,v=255===b?b:Math.min(255,255*d/(255-b))),128>o?(b=o<<1,g=0===o?b:Math.max(0,255-255*(255-c)/b)):(b=(o-128<<1)+1,g=255===b?b:Math.min(255,255*c/(255-b))),128>s?(b=s<<1,y=0===s?b:Math.max(0,255-255*(255-h)/b)):(b=(s-128<<1)+1,y=255===b?b:Math.min(255,255*h/(255-b))),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function C(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=128>a?d+(a<<1)-255:d+(a-128<<1),g=128>o?c+(o<<1)-255:c+(o-128<<1),y=128>s?h+(s<<1)-255:h+(s-128<<1),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function L(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(128>a?(b=a<<1,v=d>b?b:d):(b=a-128<<1,v=b>d?b:d),128>o?(b=o<<1,g=c>b?b:c):(b=o-128<<1,g=b>c?b:c),128>s?(b=s<<1,y=h>b?b:h):(b=s-128<<1,y=b>h?b:h),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function T(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(128>a?(b=a<<1,0!==a&&(b=Math.max(0,255-255*(255-d)/b))):0===d?b=0:(b=(a-128<<1)+1,255!==b&&(b=Math.min(255,255*d/(255-b)))),v=128>b?0:255,128>o?(b=o<<1,0!==o&&(b=Math.max(0,255-255*(255-c)/b))):0===c?b=0:(b=(o-128<<1)+1,255!==b&&(b=Math.min(255,255*c/(255-b)))),g=128>b?0:255,128>s?(b=s<<1,0!==s&&(b=Math.max(0,255-255*(255-h)/b))):0===h?b=0:(b=(s-128<<1)+1,255!==b&&(b=Math.min(255,255*h/(255-b)))),y=128>b?0:255,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function M(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(b=d-a,v=0>b?-b:b,b=c-o,g=0>b?-b:b,b=h-s,y=0>b?-b:b,e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function j(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=d+a-(d*a*32897>>22),g=c+o-(c*o*32897>>22),y=h+s-(h*s*32897>>22),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function F(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=Math.max(0,d-a),g=Math.max(0,c-o),y=Math.max(0,h-s),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function z(e,t,i,n,r){for(var a,o,s,l,d,c,h,u,f,p,m,v,g,y,w,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],d=e[x],c=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,m=(8388735-b)*u>>23,w=f+p+m,e[x+3]=w,w&&(v=0===d?0:0===a?255:Math.min(255,d/a*255),g=0===c?0:0===o?255:Math.min(255,c/o*255),y=0===h?0:0===s?255:Math.min(255,h/s*255),e[x]=(v*f+a*p+d*m)/w,e[x+1]=(g*f+o*p+c*m)/w,e[x+2]=(y*f+s*p+h*m)/w)}function D(e,t,i,a,l){for(var d,c,h,u,f,p,m,v,g,y,w,b,x,k,S,E,A=0,C=i*a<<2;C>A;A+=4)d=t[A],c=t[A+1],h=t[A+2],u=t[A+3],f=e[A],p=e[A+1],m=e[A+2],v=e[A+3],E=0|u*l*32897,g=E*v>>23,y=E*(255-v)>>23,w=(8388735-E)*v>>23,S=g+y+w,e[A+3]=S,S&&(E=s(d,c,h,o(f,p,m)),b=(16711680&E)>>16,x=(65280&E)>>8,k=255&E,E=r(b,x,k,n(f,p,m)),b=(16711680&E)>>16,x=(65280&E)>>8,k=255&E,e[A]=(b*g+d*y+f*w)/S,e[A+1]=(x*g+c*y+p*w)/S,e[A+2]=(k*g+h*y+m*w)/S)}function R(e,t,i,a,l){for(var d,c,h,u,f,p,m,v,g,y,w,b,x,k,S,E,A=0,C=i*a<<2;C>A;A+=4)d=t[A],c=t[A+1],h=t[A+2],u=t[A+3],f=e[A],p=e[A+1],m=e[A+2],v=e[A+3],E=0|u*l*32897,g=E*v>>23,y=E*(255-v)>>23,w=(8388735-E)*v>>23,S=g+y+w,e[A+3]=S,S&&(E=s(f,p,m,o(d,c,h)),b=(16711680&E)>>16,x=(65280&E)>>8,k=255&E,E=r(b,x,k,n(f,p,m)),b=(16711680&E)>>16,x=(65280&E)>>8,k=255&E,e[A]=(b*g+d*y+f*w)/S,e[A+1]=(x*g+c*y+p*w)/S,e[A+2]=(k*g+h*y+m*w)/S)}function U(e,t,i,a,o){for(var s,l,d,c,h,u,f,p,m,v,g,y,w,b,x,k,S=0,E=i*a<<2;E>S;S+=4)s=t[S],l=t[S+1],d=t[S+2],c=t[S+3],h=e[S],u=e[S+1],f=e[S+2],p=e[S+3],k=0|c*o*32897,m=k*p>>23,v=k*(255-p)>>23,g=(8388735-k)*p>>23,x=m+v+g,e[S+3]=x,x&&(k=r(s,l,d,n(h,u,f)),y=(16711680&k)>>16,w=(65280&k)>>8,b=255&k,e[S]=(y*m+s*v+h*g)/x,e[S+1]=(w*m+l*v+u*g)/x,e[S+2]=(b*m+d*v+f*g)/x)}function _(e,t,i,a,o){for(var s,l,d,c,h,u,f,p,m,v,g,y,w,b,x,k,S=0,E=i*a<<2;E>S;S+=4)s=t[S],l=t[S+1],d=t[S+2],c=t[S+3],h=e[S],u=e[S+1],f=e[S+2],p=e[S+3],k=0|c*o*32897,m=k*p>>23,v=k*(255-p)>>23,g=(8388735-k)*p>>23,x=m+v+g,e[S+3]=x,x&&(k=r(h,u,f,n(s,l,d)),y=(16711680&k)>>16,w=(65280&k)>>8,b=255&k,e[S]=(y*m+s*v+h*g)/x,e[S+1]=(w*m+l*v+u*g)/x,e[S+2]=(b*m+d*v+f*g)/x)}function B(e,t,i,n,r,a,o,s){if("normal"===s&&(s="source-over"),s in P){var l=e.getContext("2d");return l.save(),l.globalAlpha=o,l.globalCompositeOperation=s,l.drawImage(t,i,n),void l.restore()}var d=0,c=0;if(!(i>=e.width||n>=e.height||0>i+r||0>n+a||0===o)){r>t.width&&(r=t.width),a>t.height&&(a=t.height),0>i&&(r+=i,d-=i,i=0),0>n&&(a+=n,c-=n,n=0),i+r>e.width&&(r=e.width-i),n+a>e.height&&(a=e.height-n);var h=e.getContext("2d"),u=h.getImageData(i,n,r,a),f=u.data,p=t.getContext("2d").getImageData(d,c,r,a).data;if(!(s in H))throw new Error("unimplemeneted blend mode: "+s);H[s](f,p,r,a,o),h.putImageData(u,i,n)}}function N(){for(var e={},t=document.createElement("canvas"),i=t.getContext("2d"),n=0,r=Object.keys(H);n<r.length;n++){var a=r[n];i.globalCompositeOperation=a,i.globalCompositeOperation===a&&(e[a]=void 0)}return e}function I(){return new Promise(function(e){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGUlEQVQI1wXBAQEAAAgCIOz/5TJI20UGhz5D2wX8PWbkFQAAAABJRU5ErkJggg==",t.onload=function(i){var n=document.createElement("canvas");n.width=257,n.height=256;var r=n.getContext("2d");r.fillStyle="rgb(255, 255, 255)",r.fillRect(0,0,n.width,n.height),r.globalAlpha=.5,r.globalCompositeOperation="color-dodge",r.drawImage(t,0,0);var a=r.getImageData(0,0,1,1);e(a.data[0]<128)}})}var H={"copy-alpha":d,"copy-opaque":c,"source-over":h,darken:u,multiply:f,"color-burn":p,"linear-burn":m,"darker-color":v,lighten:g,screen:y,"color-dodge":w,"linear-dodge":b,"lighter-color":x,overlay:k,"soft-light":S,"hard-light":E,"vivid-light":A,"linear-light":C,"pin-light":L,"hard-mix":T,difference:M,exclusion:j,subtract:F,divide:z,hue:D,saturation:R,color:U,luminosity:_},P=N();i.blend=B,I().then(function(e){e&&delete P["color-dodge"]})},{}],2:[function(e,t,i){"use strict";function n(){var e,t,i,n=new Uint32Array(256);for(t=0;256>t;t++){for(e=t,i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;n[t]=e}return n}function r(e){for(var t=a,i=new Uint8Array(e),n=-1,r=0;r<i.length;r++)n=n>>>8^t[255&(n^i[r])];return(-1^n)>>>0}var a=n();i.crc32=r},{}],3:[function(e,t,i){"use strict";var n=function(){function e(e,t){this.src=e,this.scale=t,this.dest=document.createElement("canvas")}return Object.defineProperty(e.prototype,"destWidth",{get:function(){return 0|Math.max(1,this.src.width*this.scale)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destHeight",{get:function(){return 0|Math.max(1,this.src.height*this.scale)},enumerable:!0,configurable:!0}),e.prototype.fast=function(){this.adjustSize();var e=this.dest.getContext("2d");if(!e)throw new Error("cannot get CanvasRenderingContext2D from dest");return e.drawImage(this.src,0,0,this.src.width,this.src.height,0,0,Math.round(this.src.width*this.scale),Math.round(this.src.height*this.scale)),this.dest},e.prototype.adjustSize=function(){var e=this.destWidth;this.dest.width!==e&&(this.dest.width=e);var t=this.destHeight;this.dest.height!==t&&(this.dest.height=t)},e.prototype.beautiful=function(){var t=this.src.getContext("2d");if(!t)throw new Error("cannot get CanvasRenderingContext2D from src");var i=t.getImageData(0,0,this.src.width,this.src.height),n=new Float32Array(this.destWidth*this.destHeight<<2);e.calculate(n,i.data,this.scale,this.src.width,this.src.height),this.adjustSize();var r=this.dest.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D from dest");var a=r.createImageData(this.destWidth,this.destHeight);return e.float32ToUint8ClampedArray(a.data,n,this.destWidth,this.destHeight,a.width),r.putImageData(a,0,0),this.dest},e.prototype.beautifulWorker=function(t){var i=this,n=new Worker(e.createWorkerURL());e.activeWorker=n,n.onmessage=function(n){i.adjustSize();var r=i.dest.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D from dest");var a=r.createImageData(i.destWidth,i.destHeight);e.copyBuffer(a.data,new Uint8Array(n.data.buffer),i.destWidth,i.destHeight,a.width),r.putImageData(a,0,0),t(i.dest)};var r=this.src.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D from src");var a=r.getImageData(0,0,this.src.width,this.src.height);n.postMessage({src:a.data.buffer,srcWidth:this.src.width,srcHeight:this.src.height,scale:this.scale,destWidth:this.destWidth,destHeight:this.destHeight},[a.data.buffer])},e.copyBuffer=function(e,t,i,n,r){i*=4,r*=4;for(var a=void 0,o=0,s=0,l=0;n>o;++o)for(s=i*o,l=r*o,a=0;i>a;a+=4)e[l+a]=t[s+a],e[l+a+1]=t[s+a+1],e[l+a+2]=t[s+a+2],e[l+a+3]=t[s+a+3]},e.createWorkerURL=function(){if(e.workerURL)return e.workerURL;var t=[];return t.push("'use strict';\n"),t.push("var calculate = "+e.calculate.toString()+";\n"),t.push("var float32ToUint8ClampedArray = "+e.float32ToUint8ClampedArray.toString()+";\n"),t.push("onmessage = function(e) {\n    var d = e.data;\n    var tmp = new Float32Array(d.destWidth * d.destHeight << 2);\n    calculate(tmp, new Uint8Array(d.src), d.scale, d.srcWidth, d.srcHeight);\n    var dest = new Uint8ClampedArray(d.destWidth * d.destHeight << 2);\n    float32ToUint8ClampedArray(dest, tmp, d.destWidth, d.destHeight, d.destWidth);\n    postMessage({buffer: dest.buffer}, [dest.buffer]);\n};"),e.workerURL=URL.createObjectURL(new Blob([t.join("")],{type:"text/javascript"})),e.workerURL},e.revokeWorkerURL=function(){e.workerURL&&(URL.revokeObjectURL(e.workerURL),e.workerURL="")},e.float32ToUint8ClampedArray=function(e,t,i,n,r){i*=4,r*=4;for(var a=void 0,o=void 0,s=0,l=0,d=0;n>s;++s)for(l=i*s,d=r*s,o=0;i>o;o+=4)a=255/t[l+o+3],e[d+o]=t[l+o]*a,e[d+o+1]=t[l+o+1]*a,e[d+o+2]=t[l+o+2]*a,e[d+o+3]=t[l+o+3]},e.calculate=function(e,t,i,n,r){var a=0|n*i,o=i*i,s=0,l=0,d=0,c=0,h=0,u=0,f=0,p=0,m=0,v=0,g=0,y=0,w=0,b=0,x=0,k=0,S=!1,E=!1,A=0,C=0,L=0,T=0;for(l=0;r>l;l++)for(h=l*i,v=0|h,u=v*a<<2,E=v!==(0|h+i),E&&(x=v+1-h,k=h+i-v-1),s=0;n>s;s++,d+=4)c=s*i,m=0|c,f=u+(m<<2),S=m!==(0|c+i),S&&(w=m+1-c,b=c+i-m-1),A=t[d],C=t[d+1],L=t[d+2],T=t[d+3],0!==T&&(255>T&&(A=A*T*32897>>23,C=C*T*32897>>23,L=L*T*32897>>23),S||E?S&&!E?(g=w*i,e[f]+=A*g,e[f+1]+=C*g,e[f+2]+=L*g,e[f+3]+=T*g,y=b*i,e[f+4]+=A*y,e[f+5]+=C*y,e[f+6]+=L*y,e[f+7]+=T*y):E&&!S?(g=x*i,e[f]+=A*g,e[f+1]+=C*g,e[f+2]+=L*g,e[f+3]+=T*g,p=f+(a<<2),y=k*i,e[p]+=A*y,e[p+1]+=C*y,e[p+2]+=L*y,e[p+3]+=T*y):(g=w*x,e[f]+=A*g,e[f+1]+=C*g,e[f+2]+=L*g,e[f+3]+=T*g,y=b*x,e[f+4]+=A*y,e[f+5]+=C*y,e[f+6]+=L*y,e[f+7]+=T*y,p=f+(a<<2),y=w*k,e[p]+=A*y,e[p+1]+=C*y,e[p+2]+=L*y,e[p+3]+=T*y,y=b*k,e[p+4]+=A*y,e[p+5]+=C*y,e[p+6]+=L*y,e[p+7]+=T*y):(e[f]+=A*o,e[f+1]+=C*o,e[f+2]+=L*o,e[f+3]+=T*o))},e}();i.DownScaler=n},{}],4:[function(e,t,i){"use strict";function n(e,t){var i=new FileReader;i.onload=function(e){return t(i.result)},i.readAsArrayBuffer(new Blob([e]))}function r(e){var t=new Uint8Array(e),i="",n=0,r=0,a=0,o=0;for(t.length>=3&&239===t[0]&&187===t[1]&&191===t[2]&&(n=3);n<t.length;)if(r=t[n],128>r)i+=String.fromCharCode(r),n++;else if(r>191&&224>r){if(n+1>=t.length)throw"UTF-8 Decode failed. Two byte character was truncated.";a=t[n+1],i+=String.fromCharCode((31&r)<<6|63&a),n+=2}else{if(n+2>=t.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";a=t[n+1],o=t[n+2],i+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&o),n+=3}return i}function a(e){var t=0,i=e.replace(/\r/g,"").split("\n");i.shift();for(var n=0,r=i;n<r.length;n++){var a=r[n];a.length>2&&"//"===a.substring(0,2)&&++t}return t}var o=e("./crc32");!function(e){e[e.ShowLayerTree=0]="ShowLayerTree",e[e.ShowFaview=1]="ShowFaview",e[e.ShowFaviewAndReadme=2]="ShowFaviewAndReadme"}(i.FaviewMode||(i.FaviewMode={}));var s=(i.FaviewMode,function(){function e(e){this.json_=[{id:"root",text:e,type:"root",state:{opened:!0},children:[]}]}return Object.defineProperty(e.prototype,"json",{get:function(){return this.json_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.json_[0]},enumerable:!0,configurable:!0}),e.prototype.add=function(t,i,n){var r,a,o,s=this.json_,l=t.split("/");for(l.unshift(e.encodeName(this.root.text)),r=0;r<l.length;++r){for(o=e.decodeName(l[r]),a=0;a<s.length;++a)if(s[a].text===o){s=s[a].children,a=-1;break}a===s.length&&(r===l.length-1?s.push(e.createNode(o,i,n)):(s.push(e.createNode(o,"folder")),s=s[s.length-1].children))}},e.createNode=function(e,t,i){switch(t){case"item":return{text:e,type:t,data:{value:i},children:[]};case"folder":return{text:e,type:t,state:{opened:!0},children:[]};case"filter":return{text:e,type:t,data:{value:i},state:{opened:!0},children:[]}}throw new Error("unknown node type: "+t)},e.encodeName=function(e){return e.replace(/[\x00-\x1f\x22\x25\x27\x2f\x5c\x7e\x7f]/g,function(e){return"%"+("0"+e[0].charCodeAt(0).toString(16)).slice(-2)})},e.decodeName=function(e){return decodeURIComponent(e)},e}()),l=function(){function e(e,t,i){this.defaultRootName=t,this.psdHash="",this.faviewMode=1,this.uniqueId=Date.now().toString()+Math.random().toString().substring(2),this.changedTimer=0,this.tree=e,this.jq=jQuery(this.tree),this.initTree(i)}return Object.defineProperty(e.prototype,"rootName",{get:function(){var e=this.jst.get_node("root");return e&&e.text?e.text:this.defaultRootName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"json",{get:function(){return this.jst.get_json()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pfv",{get:function(){var e=this,t=this.json;if(1!==t.length)throw new Error("sorry but favorite tree data is broken");var i=[],n=["[PSDToolFavorites-v1]"],r=function(t){for(var a=0,o=t;a<o.length;a++){var l=o[a];switch(i.push(s.encodeName(l.text)),l.type){case"root":n.push("root-name/"+i[0]),n.push("faview-mode/"+e.faviewMode.toString()),n.push(""),i.pop(),r(l.children),i.push("");break;case"folder":l.children.length?r(l.children):(n.push("//"+i.join("/")+"~folder"),n.push(""));break;case"filter":n.push("//"+i.join("/")+"~filter"),n.push(l.data.value),n.push(""),r(l.children);break;case"item":n.push("//"+i.join("/")),n.push(l.data.value),n.push("")}i.pop()}};return r(t),n.join("\n")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renameNodes",{get:function(){var e=[],t=function(e,i){for(var n=0,r=e;n<r.length;n++){var a=r[n];i.push({id:a.id,text:a.text,originalText:a.text,children:[]}),t(a.children,i[i.length-1].children)}};return t(this.json,e),e},enumerable:!0,configurable:!0}),e.prototype.bulkRename=function(e){var t=this,i=function(e,n){for(var r=0,a=e;r<a.length;r++){var o=a[r];o.originalText!==o.text&&t.jst.rename_node(o.id,n?"_":o.text),i(o.children,n)}};i(e,!0),i(e,!1)},e.prototype.jstCheck=function(e,t,i){switch(e){case"create_node":return"root"!==t.type;case"rename_node":return!0;case"delete_node":return"root"!==t.type;case"move_node":return"root"!==t.type&&"#"!==i.id&&"item"!==i.type;case"copy_node":return"root"!==t.type&&"#"!==i.id&&"item"!==i.type}},e.prototype.clearSelection=function(){0!==this.jst.get_top_selected().length&&(this.jst.deselect_all(),this.onClearSelection&&this.onClearSelection())},e.prototype.get=function(e){return this.jst.get_node(e)},e.prototype.edit=function(e){var t=e;void 0===e&&(t=this.jst.get_top_selected()),this.jst.edit(t)},e.prototype.update=function(e){var t;if("id"in e)t=this.jst.get_node(e.id);else{var i=this.jst.get_top_selected();if(!i.length)return;t=i[0]}"type"in e&&this.jst.set_type(t,e.type),"data"in e&&(t.data=e.data)},e.prototype.getFirstFilter=function(e){for(var t=0,i=this.getParents(e,"filter");t<i.length;t++){var n=i[t];return n.data.value}return""},e.prototype.getAncestorFilters=function(e){for(var t=[],i=0,n=this.getParents(e,"filter");i<n.length;i++){var r=n[i];t.push(r.data.value)}return t},e.prototype.getParents=function(e,t){for(var i=[],n=this.jst.get_node(e.parent);n;n=this.jst.get_node(n.parent))void 0!==t&&t!==n.type||i.push(n);return i},e.prototype.remove=function(e){var t=e;void 0===e&&(t=this.jst.get_top_selected()),this.clearSelection();try{this.jst.delete_node(t)}catch(i){this.jst.delete_node(this.jst.create_node(null,"dummy","last")),this.jst.deselect_all()}},e.prototype.addNode=function(e,t,i,n){var r;switch(e){case"item":void 0!==i&&""!==i||(i="New Item"),r={text:i,type:e,data:{value:n},children:[]};break;case"folder":void 0!==i&&""!==i||(i="New Folder"),r={text:i,type:e,children:[]};break;case"filter":void 0!==i&&""!==i||(i="New Filter"),r={text:i,type:e,children:[]};break;default:throw new Error("unsupported object type: "+e)}var a=this.jst.get_top_selected(!0);if(0===a.length)return this.jst.create_node("root",r,"last");var o=a[0];if("item"!==o.type){var s=this.jst.create_node(o,r,"last");return o.state.opened||this.jst.open_node(o,null),s}var l=this.jst.get_node(o.parent),d=l.children.indexOf(o.id);return this.jst.create_node(l,r,-1!==d?d+1:"last")},e.prototype.add=function(e,t,i,n){var r=this.addNode(e,t,i,n);return this.clearSelection(),this.jst.select_node(r,!0),t&&this.jst.edit(r),r},e.prototype.addFolders=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var r=n[i];t.push(this.addNode("folder",!1,r))}this.clearSelection();for(var a=0,o=t;a<o.length;a++){var s=o[a];this.jst.select_node(s,!0)}return t},e.prototype.jstChanged=function(){var e=this;this.changedTimer&&clearTimeout(this.changedTimer),this.changedTimer=setTimeout(function(){e.changedTimer=0,e.onModified&&e.onModified(),e.updateLocalStorage()},32)},e.prototype.jstSelectionChanged=function(){var e=this.jst.get_top_selected(!0);if(0!==e.length){var t=e[0];if("item"!==t.type)return void(this.onClearSelection&&this.onClearSelection());try{this.onSelect&&this.onSelect(t)}catch(i){console.error(i),alert(i)}}},e.prototype.jstCopyNode=function(e,t){var i=this,n=function(e,t){var r=i.suggestUniqueName(e);switch(e.text!==r&&i.jst.rename_node(e,r),e.type){case"item":e.data={value:t.data.value};break;case"folder":for(var a=0;a<e.children.length;++a)n(i.jst.get_node(e.children[a]),i.jst.get_node(t.children[a]));break;case"filter":e.data={value:t.data.value};for(var a=0;a<e.children.length;++a)n(i.jst.get_node(e.children[a]),i.jst.get_node(t.children[a]))}};n(t.node,t.original)},e.prototype.jstMoveNode=function(e,t){var i=this.suggestUniqueName(t.node,t.text);t.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstCreateNode=function(e,t){var i=this.suggestUniqueName(t.node);t.node.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstRenameNode=function(e,t){var i=this.suggestUniqueName(t.node,t.text);t.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstDoubleClick=function(e){var t=this.jst.get_node(e.target);switch(t.type){case"item":case"folder":case"filter":this.onDoubleClick&&this.onDoubleClick(t);break;default:this.jst.toggle_node(t)}},e.prototype.suggestUniqueName=function(e,t){for(var i=this.jst.get_node(e),n=this.jst.get_node(i.parent),r={},a=0,o=n.children;a<o.length;a++){var s=o[a];s!==i.id&&(r[this.jst.get_text(s)]=!0)}if(void 0===t&&(t=i.text),!(t in r))return t;t+=" ";for(var l=2;t+l in r;)++l;return t+l},e.prototype.initTree=function(e,t){var i=this;this.jq.jstree("destroy"),this.jq.jstree({core:{animation:!1,check_callback:this.jstCheck,dblclick_toggle:!1,themes:{dots:!1},data:t?t:new s(this.defaultRootName).json},types:{root:{icon:!1},item:{icon:"glyphicon glyphicon-picture"},folder:{icon:"glyphicon glyphicon-folder-open"},filter:{icon:"glyphicon glyphicon-filter"}},plugins:["types","dnd","wholerow"]}),this.jst=this.jq.jstree(),this.jq.on("changed.jstree",function(e){return i.jstSelectionChanged()}),this.jq.on(["set_text.jstree","create_node.jstree","rename_node.jstree","delete_node.jstree","move_node.jstree","copy_node.jstree","cut.jstree","paste.jstree"].join(" "),function(e){return i.jstChanged()}),this.jq.on("copy_node.jstree",function(e,t){return i.jstCopyNode(e,t)}),this.jq.on("move_node.jstree",function(e,t){return i.jstMoveNode(e,t)}),this.jq.on("create_node.jstree",function(e,t){return i.jstCreateNode(e,t)}),this.jq.on("rename_node.jstree",function(e,t){return i.jstRenameNode(e,t)}),this.jq.on("dblclick.jstree",function(e){return i.jstDoubleClick(e)}),this.jq.on("ready.jstree",function(t){e&&e()})},e.prototype.updateLocalStorage=function(){var e=this,t=this.pfv;n(t,function(i){for(var n=e.getPFVListFromLocalStorage(),r=!1,s="pfv"+o.crc32(i).toString(16),l=0;l<n.length;++l)n[l].id!==e.uniqueId||n[l].hash!==e.psdHash?n[l].id===s&&n[l].hash===e.psdHash&&n.splice(l,1):(n.splice(l,1),r=!0);if(r||0!==a(t)){for(e.uniqueId=s,n.push({id:e.uniqueId,time:(new Date).getTime(),hash:e.psdHash,data:t});n.length>8;)n.shift();localStorage.psdtool_pfv=JSON.stringify(n)}})},e.prototype.getPFVListFromLocalStorage=function(){return"psdtool_pfv"in localStorage?JSON.parse(localStorage.psdtool_pfv):[]},e.prototype.getPFVFromLocalStorage=function(e){var t=this.getPFVListFromLocalStorage();if(!t.length)return null;for(var i=t.length-1;i>=0;--i)if(t[i].hash===e)return t[i]},e.prototype.loadFromArrayBuffer=function(e){return this.loadFromString(r(e),"pfv"+o.crc32(e).toString(16))},e.prototype.loadFromString=function(e,t){var i=this,r=function(t){var n=i.stringToNodeTree(e);i.initTree(function(){i.uniqueId=t,i.faviewMode=n.faviewMode,i.onLoaded&&i.onLoaded()},n.root)};return void 0!==t?r(t):n(e,function(e){r("pfv"+o.crc32(e).toString(16))}),!0},e.prototype.stringToNodeTree=function(e){var t=e.replace(/\r/g,"").split("\n");if("[PSDToolFavorites-v1]"!==t.shift())throw new Error("given PFV file does not have a valid header");for(var i,n,r,a=new s(this.defaultRootName),o={"root-name":this.defaultRootName,"faview-mode":2..toString()},l=[],d=!0,c=0,h=t;c<h.length;c++){var u=h[c];""!==u&&(u.length>2&&"//"===u.substring(0,2)?(d?(a.root.text=o["root-name"],d=!1):a.add(i,n,l.join("\n")),i=u.substring(2),-1!==i.indexOf("~")?(l=i.split("~"),i=l[0],n=l[1]):n="item",l=[]):d?(i=u.substring(0,u.indexOf("/")),r=s.decodeName(u.substring(i.length+1)),r&&(o[i]=r)):l.push(u))}d?a.root.text=o["root-name"]:a.add(i,n,l.join("\n"));var f,p=parseInt(o["faview-mode"],10);switch(p){case 0:case 1:case 2:f=p;break;default:f=2}return{root:a.json,faviewMode:f}},e}();i.Favorite=l,i.countEntries=a;var d=function(){function e(e,t,i){var n=this;this.favorite=e,this.rootSel=t,this.root=i,this.closed_=!0,this.treeRoots=[],i.addEventListener("click",function(e){return n.click(e)},!1),i.addEventListener("change",function(e){return n.change(e)},!1),i.addEventListener("input",function(e){return n.input(e)},!1),i.addEventListener("keyup",function(e){return n.keyup(e)},!1),t.addEventListener("change",function(e){return n.change(e)},!1),t.addEventListener("keyup",function(e){return n.keyup(e)},!1)}return Object.defineProperty(e.prototype,"roots",{get:function(){return this.treeRoots.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedRootIndex",{get:function(){return this.rootSel.selectedIndex},set:function(e){this.rootSel.selectedIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){for(var e=[],t=0;t<this.rootSel.length;++t){for(var i=[],n=this.treeRoots[t].getElementsByTagName("select"),r=0;r<n.length;++r){var a=n[r];if(a instanceof HTMLSelectElement){for(var o={caption:a.getAttribute("data-caption"),items:[],selectedIndex:a.selectedIndex},s=0;s<a.length;++s){var l=a.options[s];o.items.push({name:l.textContent,value:l.value})}i.push(o)}}var d=this.rootSel.options[t];e.push({name:d.textContent,value:d.value,selects:i})}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.serialize=function(){for(var e={rootSelectedValue:this.rootSel.value,items:{}},t=0;t<this.treeRoots.length;++t){for(var i={},n=this.treeRoots[t].getElementsByTagName("select"),r=0;r<n.length;++r)i[n[r].getAttribute("data-id")]={
value:n[r].value,lastMod:parseInt(n[r].getAttribute("data-lastmod"),10)};var a=this.rootSel.options[t];a instanceof HTMLOptionElement&&(e.items[a.value]=i)}return e},e.prototype.deserialize=function(e){for(var t=0;t<this.rootSel.length;++t){var i=this.rootSel.options[t];if(i instanceof HTMLOptionElement&&i.value in e.items){for(var n=e.items[i.value],r=this.treeRoots[t].getElementsByTagName("select"),a=0;a<r.length;++a){var o=r[a];if(o instanceof HTMLSelectElement){var s=o.getAttribute("data-id");if(!(s in n))continue;for(var l=0;l<o.length;++l){var d=o.options[l];if(d instanceof HTMLOptionElement&&d.value===n[s].value){o.selectedIndex=l,o.setAttribute("data-lastmod",n[s].lastMod.toString());var c=o.parentElement.querySelector("input[type=range]");c instanceof HTMLInputElement&&(c.value=l.toString());break}}}}e.rootSelectedValue===i.value&&(this.rootSel.selectedIndex=t)}}},e.prototype.rootChanged=function(){for(var e=0;e<this.treeRoots.length;++e)this.rootSel.selectedIndex===e?this.treeRoots[e].style.display="block":this.treeRoots[e].style.display="none";this.onRootChanged&&this.onRootChanged()},e.prototype.changed=function(e){e.setAttribute("data-lastmod",Date.now().toString());var t=e.parentElement.querySelector("input[type=range]");t instanceof HTMLInputElement&&(t.value=e.selectedIndex.toString()),this.onChange&&this.onChange(this.favorite.get(e.value))},e.prototype.keyup=function(e){var t=e.target;t instanceof HTMLSelectElement&&(t.blur(),t.focus())},e.prototype.change=function(e){var t=e.target;if(t instanceof HTMLSelectElement){if(t===this.rootSel)return void this.rootChanged();this.changed(t)}else if(t instanceof HTMLInputElement&&"range"===t.type){var i=t.parentElement.querySelector("select");i instanceof HTMLSelectElement&&(i.selectedIndex=parseInt(t.value,10),this.changed(i))}},e.prototype.input=function(e){var t=e.target;if(t instanceof HTMLInputElement&&"range"===t.type){var i=t.parentElement.querySelector("select");i instanceof HTMLSelectElement&&(i.selectedIndex=parseInt(t.value,10),this.changed(i))}},e.prototype.click=function(e){var t=e.target;if(t instanceof HTMLButtonElement){var i=0;if(t.classList.contains("psdtool-faview-prev")?i=-1:t.classList.contains("psdtool-faview-next")&&(i=1),0===i)return;var n=t.parentElement.querySelector("select");n instanceof HTMLSelectElement&&(n.selectedIndex=(n.length+n.selectedIndex+i)%n.length,n.focus(),this.changed(n))}},e.prototype.addNode=function(e,t){var i=e.text.replace(/^\*/,""),n=document.createElement("li"),r=document.createElement("span");r.className="glyphicon glyphicon-asterisk",n.appendChild(r),n.appendChild(document.createTextNode(" "+i)),t.appendChild(n);var a=document.createElement("select");a.className="form-control psdtool-faview-select",a.setAttribute("data-id",e.id),a.setAttribute("data-caption",i);for(var o,s,l=document.createElement("ul"),d=0,c=0,h=0,u=e.children;h<u.length;h++){var f=u[h];if("string"!=typeof f)switch(f.type){case"item":o=document.createElement("option"),o.textContent=f.text,o.value=f.id,1===++d&&(s=f.id),a.appendChild(o);break;case"folder":case"filter":this.addNode(f,l),++c}}if(d>0&&""!==this.favorite.getFirstFilter(this.favorite.get(s))){var p=document.createElement("input");p.type="range",p.max=(d-1).toString(),p.value="0";var m=document.createElement("button");m.className="btn btn-default psdtool-faview-prev",m.innerHTML="&lt;",m.tabIndex=-1;var v=document.createElement("button");v.className="btn btn-default psdtool-faview-next",v.innerHTML="&gt;",v.tabIndex=-1;var g=document.createElement("div");g.className="psdtool-faview-select-container",1===d&&(m.disabled=!0,a.disabled=!0,p.disabled=!0,v.disabled=!0),g.appendChild(m),g.appendChild(a),g.appendChild(p),g.appendChild(v),n.appendChild(g)}c>0&&n.appendChild(l)},e.prototype.addRoot=function(e){for(var t,i=0,n=e;i<n.length;i++){var r=n[i];if(r.text.length>1&&"*"===r.text.charAt(0)){t=document.createElement("option"),t.value=r.id,t.textContent=r.text.substring(1),this.rootSel.appendChild(t);for(var a=document.createElement("ul"),o=0,s=r.children;o<s.length;o++){var l=s[o];if("string"!=typeof l)switch(l.type){case"folder":case"filter":this.addNode(l,a)}}var d=document.createElement("li");d.style.display="none",d.appendChild(a),this.treeRoots.push(d),this.root.appendChild(d);for(var c=d.getElementsByTagName("select"),h=0;h<c.length;++h)c[h].setAttribute("data-lastmod",(c.length-h).toString())}this.addRoot(r.children)}},e.prototype.start=function(e){this.treeRoots=[],this.rootSel.innerHTML="",this.root.innerHTML="",this.addRoot(this.favorite.json),void 0!==e&&this.deserialize(e),this.roots>0&&this.rootChanged(),this.closed_=!1},e.prototype.refresh=function(){this.start(this.serialize())},e.prototype.getActive=function(){for(var e=this.treeRoots[this.rootSel.selectedIndex].getElementsByTagName("select"),t=[],i=0;i<e.length;++i)t.push({n:this.favorite.get(e[i].value),lastMod:parseInt(e[i].getAttribute("data-lastmod"),10)});t.sort(function(e,t){return e.lastMod===t.lastMod?0:e.lastMod<t.lastMod?-1:1});for(var n=[],r=0,a=t;r<a.length;r++){var i=a[r];n.push(i.n)}return n},e.prototype.close=function(){this.treeRoots=[],this.rootSel.innerHTML="",this.root.innerHTML="",this.closed_=!0},e}();i.Faview=d},{"./crc32":2}],5:[function(e,t,i){"use strict";!function(e){e[e.NoFlip=0]="NoFlip",e[e.FlipX=1]="FlipX",e[e.FlipY=2]="FlipY",e[e.FlipXY=3]="FlipXY"}(i.FlipType||(i.FlipType={}));var n=(i.FlipType,function(){function e(t,i,n,r,a,o){this.input=t,this.displayName_=i,this.name_=n,this.parent=o,this.children=[],this.internalName_=e.encodeLayerName(this.name,a),r.length?this.fullPath_=r.join("/")+"/"+this.internalName_:this.fullPath_=this.internalName_}return Object.defineProperty(e.prototype,"checked",{get:function(){return this.input.checked},set:function(e){this.input.checked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.input.disabled},set:function(e){this.input.disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.displayName_.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalName",{get:function(){return this.internalName_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.fullPath_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return!this.input},enumerable:!0,configurable:!0}),e.encodeLayerName=function(e,t){return e.replace(/[\x00-\x1f\x22\x25\x27\x2f\x5c\x7e\x7f]/g,function(e){return"%"+("0"+e[0].charCodeAt(0).toString(16)).slice(-2)})+(0===t?"":"\\"+t.toString())},e}());i.Node=n;var r=function(){function e(e,t,i){var r=this;this.disableExtendedFeature=e,this.treeRoot=t,this.root=new n(null,null,"",[],0,null),this.nodes={},this.flipX=[],this.flipY=[],this.flipXY=[],this.flip_=0;var a=[],o=function(e,t,i,s){for(var l={},d={},c=0,h=i;c<h.length;c++){var u=h[c];u.Name in d?l[u.SeqID]=++d[u.Name]:l[u.SeqID]=d[u.Name]=0}for(var f=i.length-1;f>=0;--f){var p=r.createElements(i[f],s),m=new n(p.input,p.text,i[f].Name,a,l[i[f].SeqID],t);t.children.push(m),r.nodes[i[f].SeqID]=m;var v=document.createElement("ul");a.push(m.internalName),o(v,m,i[f].Children,i[f].SeqID),a.pop(),m.li=document.createElement("li"),i[f].Folder&&m.li.classList.add("psdtool-folder"),m.li.appendChild(p.div),m.li.appendChild(v),e.appendChild(m.li)}};o(t,this.root,i.Children,-1),this.registerClippingGroup(i.Children),this.disableExtendedFeature||this.registerFlippingGroup(),this.normalize(),this.flip=this.flip}return Object.defineProperty(e.prototype,"text",{get:function(){var e=[],t=[],i=function(n){for(var r=0,a=n.children;r<a.length;r++){var o=a[r];e.push(t.join("")+o.name),t.push("	"),i(o),t.pop()}};return i(this.root),e.join("\n")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flip",{get:function(){return this.flip_},set:function(e){switch(this.flip_=e,this.treeRoot.classList.remove("psdtool-flip-x","psdtool-flip-y","psdtool-flip-xy"),e){case 0:this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!1);break;case 1:this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!1),this.doFlip(this.flipX,!0),this.treeRoot.classList.add("psdtool-flip-x");break;case 2:this.doFlip(this.flipXY,!1),this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!0),this.treeRoot.classList.add("psdtool-flip-y");break;case 3:this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!0),this.treeRoot.classList.add("psdtool-flip-xy")}},enumerable:!0,configurable:!0}),e.prototype.flipSerialize=function(e){var t=function(e,i){for(var n,r=0,a=e.children;r<a.length;r++){var o=a[r];i.children[o.internalName]=n={checked:o.checked,children:{}},t(o,n)}},i={checked:e.checked,children:{}};return t(e,i),i},e.prototype.flipDeserialize=function(e,t){var i=function(e,t){for(var n,r=0,a=e.children;r<a.length;r++){var o=a[r];o.internalName in t.children&&(n=t.children[o.internalName],o.checked=n.checked,i(o,n))}};i(e,t)},e.prototype.doFlip=function(e,t){for(var i=0,n=e;i<n.length;i++){var r=n[i];if(t&&r.normal.checked){var a=this.flipSerialize(r.normal);this.flipDeserialize(r.flipped,a),r.flipped.checked=!0,r.normal.checked=!1}else if(!t&&r.flipped.checked){var a=this.flipSerialize(r.flipped);this.flipDeserialize(r.normal,a),r.normal.checked=!0,r.flipped.checked=!1}}},e.prototype.createElements=function(e,t){var i=document.createElement("label"),n=document.createElement("input"),r=e.Name;if(!this.disableExtendedFeature&&r.length>1)switch(r.charAt(0)){case"!":n.className="psdtool-layer-visible psdtool-layer-force-visible",n.name="l"+e.SeqID,n.type="checkbox",n.checked=!0,n.disabled=!0,n.style.display="none",r=r.substring(1);break;case"*":n.className="psdtool-layer-visible psdtool-layer-radio",n.name="r_"+t,n.type="radio",n.checked=e.Visible,r=r.substring(1)}if(n.name||(n.className="psdtool-layer-visible",n.name="l"+e.SeqID,n.type="checkbox",n.checked=e.Visible),this.disableExtendedFeature||(r=this.parseToken(r).name),n.setAttribute("data-seq",e.SeqID.toString()),i.appendChild(n),e.Clipping){var a=document.createElement("img");a.className="psdtool-clipped-mark",a.src="img/clipped.svg",a.alt="clipped mark",i.appendChild(a)}if(e.Folder){var o=document.createElement("span");o.className="psdtool-icon glyphicon glyphicon-folder-open",o.setAttribute("aria-hidden","true"),i.appendChild(o)}else{var s=document.createElement("canvas");if(s.className="psdtool-thumbnail",s.width=96,s.height=96,e.Canvas){var l=e.Width,d=e.Height;l>d?(l=s.width,d=s.width/e.Width*d):(d=s.height,l=s.height/e.Height*l);var c=s.getContext("2d");if(!c)throw new Error("cannot get CanvasRenderingContext2D for make thumbnail");c.drawImage(e.Canvas,(s.width-l)/2,(s.height-d)/2,l,d)}i.appendChild(s)}var h=document.createTextNode(r);i.appendChild(h);var u=document.createElement("div");return u.className="psdtool-layer-name",u.appendChild(i),{text:h,div:u,input:n}},e.prototype.updateClass=function(){function e(t){if(t.checked){if(t.li.classList.remove("psdtool-hidden"),t.clip)for(var i=0;i<t.clip.length;++i)t.clip[i].li.classList.remove("psdtool-hidden-by-clipping")}else if(t.li.classList.add("psdtool-hidden"),t.clip)for(var i=0;i<t.clip.length;++i)t.clip[i].li.classList.add("psdtool-hidden-by-clipping");for(var i=0;i<t.children.length;++i)e(t.children[i])}for(var t=0;t<this.root.children.length;++t)e(this.root.children[t])},e.prototype.registerClippingGroup=function(e){for(var t,i=[],n=e.length-1;n>=0;--n)if(this.registerClippingGroup(e[n].Children),t=this.nodes[e[n].SeqID],e[n].Clipping)i.unshift(t);else{if(i.length){for(var r=0;r<i.length;++r)i[r].clippedBy=t;t.clip=i}i=[]}},e.prototype.parseToken=function(e){for(var t=[],i=e.split(":"),n=i.length-1;n>=0;--n)switch(i[n]){case"flipx":case"flipy":case"flipxy":t.push(i.pop());break;default:return{tokens:t,name:i.join(":")}}throw new Error("cannot parse token from name: "+e)},e.prototype.registerFlippingGroup=function(){var e=this,t=function(i){for(var n=0,r=i.children;n<r.length;n++){var a=r[n];t(a);for(var o=e.parseToken(a.name),s=[],l=0,d=o.tokens;l<d.length;l++){var c=d[l];switch(c){case"flipx":s.push(1);break;case"flipy":s.push(2);break;case"flipxy":s.push(3)}}if(0!==s.length){for(var h=void 0,u=0,f=i.children;u<f.length;u++){var p=f[u];if(p.name===o.name){h=p;break}}if(h)for(var m=0,v=s;m<v.length;m++){var g=v[m];switch(g){case 1:h.li.classList.add("psdtool-item-flip-x-orig"),a.li.classList.add("psdtool-item-flip-x"),e.flipX.push({normal:h,flipped:a});break;case 2:h.li.classList.add("psdtool-item-flip-y-orig"),a.li.classList.add("psdtool-item-flip-y"),e.flipY.push({normal:h,flipped:a});break;case 3:h.li.classList.add("psdtool-item-flip-xy-orig"),a.li.classList.add("psdtool-item-flip-xy"),e.flipXY.push({normal:h,flipped:a})}}}}};t(this.root)},e.prototype.getAllNode=function(){var e,t=[];for(var i in this.nodes)this.nodes.hasOwnProperty(i)&&(e=this.nodes[i],e.checked&&t.push(e));return t},e.prototype.serialize=function(e){var t=this.getAllNode();if(!t.length)return"";if(e){for(var i=[],n=0,r=t;n<r.length;n++){var a=r[n];i.push("/"+a.fullPath)}return i.join("\n")}var o,s=[],l={};for(o=0;o<t.length;++o)s.push({node:t[o],fullPathSlash:t[o].fullPath+"/",index:o}),l[t[o].fullPath]=!0;s.sort(function(e,t){return e.fullPathSlash>t.fullPathSlash?1:e.fullPathSlash<t.fullPathSlash?-1:0});var d,c;for(o=0;o<s.length;++o){for(c=s[o].node.fullPath.split("/"),d=0;d<c.length;++d)if(!l[c.slice(0,d+1).join("/")]){s.splice(o--,1),d=-1;break}-1!==d&&o>0&&0===s[o].fullPathSlash.indexOf(s[o-1].fullPathSlash)&&s.splice(--o,1)}s.sort(function(e,t){return e.index>t.index?-1:e.index<t.index?1:0}),c=[];for(var h=0,u=s;h<u.length;h++){var f=u[h];c.push(f.node.fullPath)}return c.join("\n")},e.prototype.buildDeserializeTree=function(e){for(var t,i,n,r="/"===e.charAt(0),a={children:{},checked:!0,allLayer:r},o=e.replace(/\r/g,"").split("\n"),s=0,l=o;s<l.length;s++){var d=l[s];for(n=d.split("/"),t=r?1:0,i=a;t<n.length;++t)n[t]in i.children||(i.children[n[t]]={children:{},checked:!r}),i=i.children[n[t]];r&&(i.checked=!0)}return a},e.prototype.apply=function(e,t,i){for(var n,r,a={},o=0,s=t.children;o<s.length;o++)n=s[o],a[n.internalName]=!0,e&&(r=e.children[n.internalName]),e&&r?(r.checked&&(n.checked=!0),this.apply(r,n,i)):(n.checked=!1,i&&this.apply(null,n,i))},e.prototype.deserialize=function(e){var t=this.serialize(!0);try{var i=this.buildDeserializeTree(e);i.allLayer&&(this.clear(),this.normalize()),this.apply(i,this.root,i.allLayer),this.flip=this.flip}catch(n){throw this.apply(this.buildDeserializeTree(t),this.root,!0),this.flip=this.flip,n}},e.prototype.buildFilterTree=function(e){for(var t,i,n={children:{}},r=0,a=e.replace(/\r/g,"").split("\n");r<a.length;r++){var o=a[r];i=o.split("/"),t=n;for(var s=0,l=i;s<l.length;s++){var d=l[s];d in t.children||(t.children[d]={children:{}}),t=t.children[d]}}return n},e.prototype.applyWithFilter=function(e,t,i){for(var n,r,a,o={},s=0,l=i.children;s<l.length;s++)n=l[s],o[n.internalName]=!0,t&&(r=t.children[n.internalName]),t&&r&&(e&&(a=e.children[n.internalName]),e&&a?(a.checked&&(n.checked=!0),this.applyWithFilter(a,r,n)):n.checked=!1)},e.prototype.deserializePartial=function(e,t,i){var n=this.serialize(!0);try{if(void 0!==e)if(""===e)this.clear();else{var r=this.buildDeserializeTree(e);r.allLayer&&(this.clear(),this.normalize()),this.apply(r,this.root,r.allLayer)}var a=this.buildDeserializeTree(t);if(a.allLayer)throw new Error("cannot use allLayer mode in LayerTree.deserializePartial");this.applyWithFilter(a,this.buildFilterTree(i),this.root),this.flip=this.flip}catch(o){throw this.apply(this.buildDeserializeTree(n),this.root,!0),this.flip=this.flip,o}},e.prototype.clear=function(){for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(this.nodes[e].checked=!1)},e.prototype.normalize=function(){var e=document.getElementById("layer-tree");if(!e)throw new Error("#layer-tree not found");for(var t=e.querySelectorAll(".psdtool-layer-force-visible"),i=0;i<t.length;++i)t[i].checked=!0;for(var n={},r=e.querySelectorAll(".psdtool-layer-radio"),i=0;i<r.length;++i){var a=r[i];if(!(a instanceof HTMLInputElement))throw new Error("found .psdtool-layer-radio that are not HTMLInputElement");if(!(a.name in n)){n[a.name]=!0;var o=e.querySelectorAll('.psdtool-layer-radio[name="'+a.name+'"]:checked');o.length||(a.checked=!0)}}},e}();i.LayerTree=r;var a=function(){function e(e,t){var i=this;this.root=new n(null,null,"",[],0,null),this.nodes={};var r=[],a=function(e,t,o){for(var s={},l={},d=0,c=o;d<c.length;d++){var h=c[d];h.Name in l?s[h.SeqID]=++l[h.Name]:s[h.SeqID]=l[h.Name]=0}for(var u=o.length-1;u>=0;--u){var f=i.createElements(o[u]),p=new n(f.input,f.text,o[u].Name,r,s[o[u].SeqID],t);t.children.push(p),i.nodes[o[u].SeqID]=p,p.li=document.createElement("li");var m=document.createElement("ul");r.push(p.internalName),a(m,p,o[u].Children),r.pop(),p.li.appendChild(f.label),p.li.appendChild(m),e.appendChild(p.li)}};a(e,this.root,t.Children)}return e.prototype.createElements=function(e){var t=document.createElement("input");t.type="checkbox",t.checked=!0,t.setAttribute("data-seq",e.SeqID.toString());var i=document.createTextNode(e.Name),n=document.createElement("label");return n.appendChild(t),n.appendChild(i),{text:i,label:n,input:t}},e.prototype.getAllNode=function(){var e,t=[],i=0;for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&(e=this.nodes[n],e.disabled||(++i,e.checked&&t.push(e)));return t.length===i?[]:t},e.prototype.serialize=function(){var e=this.getAllNode();if(!e.length)return"";var t,i=[],n={};for(t=0;t<e.length;++t)i.push({node:e[t],fullPathSlash:e[t].fullPath+"/",index:t}),n[e[t].fullPath]=!0;i.sort(function(e,t){return e.fullPathSlash>t.fullPathSlash?1:e.fullPathSlash<t.fullPathSlash?-1:0});var r,a;for(t=0;t<i.length;++t){for(a=i[t].node.fullPath.split("/"),r=0;r<a.length;++r)if(!n[a.slice(0,r+1).join("/")]){i.splice(t--,1),r=-1;break}-1!==r&&t>0&&0===i[t].fullPathSlash.indexOf(i[t-1].fullPathSlash)&&i.splice(--t,1)}for(i.sort(function(e,t){return e.index>t.index?-1:e.index<t.index?1:0}),a=[],t=0;t<i.length;++t)a.push(i[t].node.fullPath);return a.join("\n")},e.prototype.buildDeserializeTree=function(e){for(var t,i,n={children:{},checked:!0},r=e.replace(/\r/g,"").split("\n"),a=0,o=r;a<o.length;a++){var s=o[a];i=s.split("/"),t=n;for(var l=0,d=i;l<d.length;l++){var c=d[l];c in t.children||(t.children[c]={children:{},checked:!0}),t=t.children[c]}}return n},e.prototype.apply=function(e,t,i){for(var n,r={},a=0,o=t.children;a<o.length;a++){var s=o[a];s.disabled||(r[s.internalName]=!0,e&&(n=e.children[s.internalName]),e&&n?(s.checked=n.checked,this.apply(n,s,i)):(i&&(s.disabled=!0),s.checked=!1,this.apply(null,s,i)))}},e.prototype.deserialize=function(e,t){var i=this.serialize();try{for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&(this.nodes[n].disabled=!1,this.nodes[n].checked=!1);for(var r=t.length-1;r>=0;--r)this.apply(this.buildDeserializeTree(t[r]),this.root,!0);if(""===e)return;this.apply(this.buildDeserializeTree(e),this.root,!1)}catch(a){throw this.apply(this.buildDeserializeTree(i),this.root,!1),a}},e}();i.Filter=a},{}],6:[function(e,t,i){"use strict";function n(e,t){var i=e.getElementById(t);if(!i)throw new Error("#"+t+" not found");return i}var r=e("./renderer"),a=e("./zipper"),o=e("./favorite"),s=e("./layertree"),l=e("./tileder"),d=function(){function e(e,t){this.bar=n(document,"progress-dialog-progress-bar"),this.text=document.createTextNode("");var i=n(document,"progress-dialog-label");i.innerHTML="",i.appendChild(document.createTextNode(e));var r=n(document,"progress-dialog-progress-caption");r.innerHTML="",r.appendChild(this.text),this.update(0,t),this.dialog=jQuery("#progress-dialog"),this.dialog.data("bs.modal")?this.dialog.modal("show"):this.dialog.modal()}return e.prototype.close=function(){this.dialog.modal("hide")},e.prototype.update=function(e,t){var i=Math.min(100,Math.max(0,100*e));this.bar.style.width=i+"%",this.bar.setAttribute("aria-valuenow",i.toFixed(0)+"%"),this.text.data=i.toFixed(0)+"% "+t},e}(),c=function(){function e(e){this.favorite=e}return e.prototype.init=function(){var e=this,t=n(document,"filter-tree");if(!(t instanceof HTMLUListElement))throw new Error("#filter-tree is not an UL element");this.treeRoot=t,this.treeRoot.innerHTML="",this.treeRoot.addEventListener("click",function(t){var i=t.target;if(i instanceof HTMLInputElement){for(var n=i.parentElement;!(n instanceof HTMLLIElement);)n=n.parentElement;for(var r=i.checked,a=n.querySelectorAll("input"),o=0;o<a.length;++o){var s=a[o];s instanceof HTMLInputElement&&(s.checked=r)}if(r)for(var l=n.parentElement;l!==e.treeRoot;l=l.parentElement)if(l instanceof HTMLLIElement){var d=l.querySelector("input");d instanceof HTMLInputElement&&(d.checked=!0)}e.updateClass(),e.update()}},!1);var i=n(document,"use-filter");if(!(i instanceof HTMLInputElement))throw new Error("#filter-tree is not an INPUT element");this.useFilter=i,this.useFilter.addEventListener("click",function(t){e.updateClass(),e.update()},!1);var r=n(document,"filter-dialog");if(!(r instanceof HTMLDivElement))throw new Error("#filter-dialog is not an DIV element");this.dialog=r,jQuery(this.dialog).on("shown.bs.modal",function(t){var i=e.favorite.getAncestorFilters(e.node);"filter"===e.node.type?(e.useFilter.checked=!0,e.root.deserialize(e.node.data?e.node.data.value:"",i)):(e.useFilter.checked=!1,e.root.deserialize("",i)),e.updateClass()})},e.prototype.load=function(e){this.treeRoot||this.init(),this.root=new s.Filter(this.treeRoot,e)},e.prototype.updateClass=function(){this.useFilter.checked?this.treeRoot.classList.remove("disabled"):this.treeRoot.classList.add("disabled");for(var e=this.treeRoot.querySelectorAll("input"),t=0,i=void 0,n=void 0;t<e.length;++t)if(i=e[t],i instanceof HTMLInputElement){for(n=i.parentElement;n&&"LI"!==n.tagName;)n=n.parentElement;i.disabled?n.classList.add("disabled"):n.classList.remove("disabled"),i.checked?n.classList.add("checked"):n.classList.remove("checked")}},e.prototype.update=function(){if(this.useFilter.checked){var e=this.root.serialize();if(e)return void(this.onUpdate&&this.onUpdate(this.node.id||"","filter",e))}this.onUpdate&&this.onUpdate(this.node.id||"","folder","")},e.prototype.show=function(e){this.node=e;var t=jQuery(this.dialog);t.data("bs.modal")?t.modal("show"):t.modal()},e}(),h=function(){function e(e){var t=this;this.favorite=e;var i=n(document,"faview-mode");if(!(i instanceof HTMLSelectElement))throw new Error("#faview-mode is not a SELECT element");this.faviewMode=i,this.faviewMode.addEventListener("change",function(e){return t.update()});var r=n(document,"faview-setting-dialog");if(!(r instanceof HTMLDivElement))throw new Error("#faview-setting-dialog is not an DIV element");this.dialog=r,jQuery(this.dialog).on("shown.bs.modal",function(e){t.faviewMode.selectedIndex=t.favorite.faviewMode})}return e.prototype.update=function(){this.favorite.faviewMode=this.faviewMode.selectedIndex,this.onUpdate&&this.onUpdate()},e}(),u=function(){function e(){this.sideBodyScrollPos={}}return e.prototype.init=function(){var t=this;e.initDropZone("dropzone",function(e){var i,n;for(i=0;i<e.length;++i)if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"===n){t.droppedPFV=e[i];break}for(i=0;i<e.length;++i)if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"!==n)return void t.loadAndParse(e[i])}),this.initUI(),n(document,"samplefile").addEventListener("click",function(e){return t.loadAndParse(n(document,"samplefile").getAttribute("data-filename"))},!1),window.addEventListener("resize",function(e){return t.resized()},!1),window.addEventListener("hashchange",function(e){return t.hashchanged()},!1),this.hashchanged();for(var i=document.querySelectorAll(".psdtool-loading"),r=0;r<i.length;++r)i[r].classList.add("psdtool-loaded"),i[r].classList.remove("psdtool-loading")},e.prototype.hashchanged=function(){var e=decodeURIComponent(location.hash.substring(1));"load:"===e.substring(0,5)&&this.loadAndParse(e.substring(5))},e.prototype.resized=function(){var e=n(document,"main-container"),t=n(document,"misc-ui"),i=n(document,"preview-container"),r=i.style.display;i.style.display="none",i.style.width=e.clientWidth+"px",i.style.height=e.clientHeight-t.offsetHeight+"px",i.style.display=r;var a=n(document,"side-container"),o=n(document,"side-head"),s=n(document,"side-body");r=s.style.display,s.style.display="none",s.style.width=a.clientWidth+"px",s.style.height=a.clientHeight-o.offsetHeight+"px",s.style.display=r;for(var l=document.querySelectorAll(".psdtool-tab-toolbar"),d=0;d<l.length;++d){var c=l[d];if(c instanceof HTMLElement){for(var h=c.parentElement;!h.classList.contains("psdtool-tab-pane")&&h;)h=h.parentElement;h&&(h.style.paddingTop=c.clientHeight+"px")}}},e.prototype.loadAndParse=function(t){var i=this,r=n(document,"file-open-ui"),a=n(document,"error-report-ui"),o=n(document,"main");r.style.display="block",a.style.display="none",o.style.display="none",Mousetrap.pause();var s=n(document,"error-message"),l=document.createTextNode("");s.innerHTML="",s.appendChild(l);var c=new d("Loading...","Getting ready...");e.loadAsBlob(function(e){return c.update(e,"Receiving file...")},t).then(function(e){return i.parse(function(e){return c.update(e,"Loading file...")},e)}).then(function(){c.close(),r.style.display="none",a.style.display="none",o.style.display="block",Mousetrap.unpause(),i.resized()},function(e){c.close(),r.style.display="block",a.style.display="block",o.style.display="none",Mousetrap.pause(),l.data=e.toString(),console.error(e)})},e.prototype.parse=function(e,t){var i=this,r=m.deferred();return PSD.parseWorker(t.buffer,e,function(e){try{i.psdRoot=e,i.loadLayerTree(e),i.filterDialog.load(e),i.loadRenderer(e),i.maxPixels.value=(i.optionAutoTrim.checked?i.renderer.Height:i.renderer.CanvasHeight).toString(),i.seqDlPrefix.value=t.name,i.seqDlNum.value="0";for(var a=document.querySelectorAll(".psdtool-show-readme"),o=0,s=void 0;o<a.length;++o)s=a[o],s instanceof HTMLElement&&(""!==e.Readme?s.classList.remove("hidden"):s.classList.add("hidden"));if(n(document,"readme").textContent=e.Readme,i.favorite.psdHash=e.Hash,i.droppedPFV){var l=new FileReader;l.onload=function(){i.favorite.loadFromArrayBuffer(l.result)},l.readAsArrayBuffer(i.droppedPFV)}else{var d=i.favorite.getPFVFromLocalStorage(e.Hash);d&&d.time/1e3>e.PFVModDate?i.favorite.loadFromString(d.data,d.id):e.PFV&&i.favorite.loadFromString(e.PFV)}i.redraw(),r.resolve(!0)}catch(c){r.reject(c)}},function(e){return r.reject(e)}),r.promise},e.prototype.pfvOnDrop=function(e){var t=this;this.leaveReaderMode();var i,n,r=function(){if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"===n){var r=new FileReader;return r.onload=function(e){t.favorite.loadFromArrayBuffer(r.result)&&jQuery("#import-dialog").modal("hide")},r.readAsArrayBuffer(e[i]),{value:void 0}}};for(i=0;i<e.length;++i){var a=r();if("object"==typeof a)return a.value}},e.prototype.initFavoriteUI=function(){var t=this;this.favorite=new o.Favorite(n(document,"favorite-tree"),n(document,"favorite-tree").getAttribute("data-root-name")),this.favorite.onModified=function(){t.needRefreshFaview=!0},this.favorite.onLoaded=function(){switch(t.startFaview(),t.favorite.faviewMode){case 0:t.toggleTreeFaview(!1);break;case 1:t.faview.closed||t.toggleTreeFaview(!0);break;case 2:t.faview.closed||(t.toggleTreeFaview(!0),""!==t.psdRoot.Readme&&jQuery("#readme-dialog").modal("show"))}},this.favorite.onClearSelection=function(){return t.leaveReaderMode()},this.favorite.onSelect=function(e){if("item"!==e.type)return void t.leaveReaderMode();try{t.enterReaderMode(e.data.value,t.favorite.getFirstFilter(e),e.text+".png")}catch(i){console.error(i),alert(i)}},this.favorite.onDoubleClick=function(e){try{switch(e.type){case"item":t.leaveReaderMode(e.data.value,t.favorite.getFirstFilter(e));break;case"folder":case"filter":t.filterDialog.show(e)}}catch(i){console.error(i),alert(i)}},this.filterDialog=new c(this.favorite),this.filterDialog.onUpdate=function(e,i,n){t.favorite.update({id:e,type:i,data:{value:n}}),t.favorite.updateLocalStorage(),t.needRefreshFaview=!0},jQuery("button[data-psdtool-tree-add-item]").on("click",function(e){t.leaveReaderMode(),t.favorite.add("item",!0,"",t.layerRoot.serialize(!1))}),Mousetrap.bind("mod+b",function(e){e.preventDefault();var i=t.lastCheckedNode?t.lastCheckedNode.displayName:"New Item";i=prompt(document.querySelector("button[data-psdtool-tree-add-item]").getAttribute("data-caption"),i),null!==i&&(t.leaveReaderMode(),t.favorite.add("item",!1,i,t.layerRoot.serialize(!1)))}),jQuery("button[data-psdtool-tree-add-folder]").on("click",function(e){t.favorite.add("folder",!0)}),Mousetrap.bind("mod+d",function(e){e.preventDefault();var i=prompt(document.querySelector("button[data-psdtool-tree-add-folder]").getAttribute("data-caption"),"New Folder");null!==i&&(t.favorite.clearSelection(),t.favorite.add("folder",!1,i))}),jQuery("button[data-psdtool-tree-rename]").on("click",function(e){return t.favorite.edit()}),Mousetrap.bind("f2",function(e){e.preventDefault(),t.favorite.edit()}),jQuery("button[data-psdtool-tree-remove]").on("click",function(e){return t.favorite.remove()}),Mousetrap.bind("shift+mod+g",function(e){var i=e.target;if(i instanceof HTMLElement&&i.classList.contains("psdtool-layer-visible")){if(e.preventDefault(),!i.classList.contains("psdtool-layer-radio"))return;if(i instanceof HTMLInputElement){for(var n=t.layerRoot.serialize(!0),r=[],a=void 0,o=document.querySelectorAll('input[name="'+i.name+'"].psdtool-layer-radio'),s=0;s<o.length;++s)a=t.layerRoot.nodes[parseInt(o[s].getAttribute("data-seq"),10)],a.li.classList.contains("psdtool-item-flip-x")||a.li.classList.contains("psdtool-item-flip-y")||a.li.classList.contains("psdtool-item-flip-xy")||(a.checked=!0,t.favorite.add("item",!1,a.displayName,t.layerRoot.serialize(!1)),r.push(a.displayName));t.layerRoot.deserialize(n),t.redraw(),alert(r.length+" favorite item(s) has been added.\n\n"+r.join("\n"))}}}),e.initDropZone("pfv-dropzone",function(e){return t.pfvOnDrop(e)}),e.initDropZone("pfv-dropzone2",function(e){return t.pfvOnDrop(e)}),jQuery("#import-dialog").on("shown.bs.modal",function(i){var r=n(document,"pfv-recents");r.innerHTML="";for(var a,s=t.favorite.getPFVListFromLocalStorage(),l=s.length-1;l>=0;--l)a=document.createElement("button"),a.type="button",a.className="list-group-item",s[l].hash===t.psdRoot.Hash&&(a.className+=" list-group-item-info"),a.setAttribute("data-dismiss","modal"),function(e,i,n){e.addEventListener("click",function(e){t.leaveReaderMode(),t.favorite.loadFromString(i,n)},!1)}(a,s[l].data,s[l].id),a.appendChild(document.createTextNode(o.countEntries(s[l].data)+" item(s) / Created at "+e.formateDate(new Date(s[l].time)))),r.appendChild(a)}),jQuery("#bulk-create-folder-dialog").on("shown.bs.modal",function(e){return t.bulkCreateFolderTextarea.focus()});var i=n(document,"bulk-create-folder-textarea");if(!(i instanceof HTMLTextAreaElement))throw new Error("element not found: #bulk-create-folder-textarea");this.bulkCreateFolderTextarea=i,n(document,"bulk-create-folder").addEventListener("click",function(e){for(var i=[],n=0,r=t.bulkCreateFolderTextarea.value.replace(/\r/g,"").split("\n");n<r.length;n++){var a=r[n];a=a.trim(),""!==a&&i.push(a)}t.favorite.addFolders(i),t.bulkCreateFolderTextarea.value=""},!1),jQuery("#bulk-rename-dialog").on("shown.bs.modal",function(e){var i=function(e,t){for(var n,r,a,o=0,s=t;o<s.length;o++){var l=s[o];a=document.createElement("input"),a.className="form-control",a.value=l.text,function(e,t){e.onblur=function(i){t.text=e.value.trim()}}(a,l),r=document.createElement("li"),r.appendChild(a),n=document.createElement("ul"),r.appendChild(n),i(n,l.children),e.appendChild(r)}},r=n(document,"bulk-rename-tree");t.bulkRenameData=t.favorite.renameNodes,r.innerHTML="",i(r,t.bulkRenameData);
}),n(document,"bulk-rename").addEventListener("click",function(e){var i=1,r=n(document,"rename-digits");r instanceof HTMLSelectElement&&(i=parseInt(r.value,10));var a=0,r=n(document,"rename-start-number");r instanceof HTMLInputElement&&(a=parseInt(r.value,10));for(var o=n(document,"bulk-rename-tree").querySelectorAll("input"),s=0;s<o.length;++s){var r=o[s];r instanceof HTMLInputElement&&""===r.value&&(r.value=("0000"+a.toString()).slice(-i),r.onblur(null),++a)}t.favorite.bulkRename(t.bulkRenameData)},!1),n(document,"export-favorites-pfv").addEventListener("click",function(i){saveAs(new Blob([t.favorite.pfv],{type:"text/plain"}),e.cleanForFilename(t.favorite.rootName)+".pfv")},!1),n(document,"export-favorites-zip").addEventListener("click",function(e){t.exportZIP(!1)},!1),n(document,"export-favorites-zip-filter-solo").addEventListener("click",function(e){t.exportZIP(!0)},!1);for(var r=document.querySelectorAll("[data-export-faview]"),a=0;a<r.length;++a)!function(e){e.addEventListener("click",function(i){t.exportFaview("standard"===e.getAttribute("data-export-faview"),"flat"===e.getAttribute("data-structure"))})}(r[a]);n(document,"export-tiled").addEventListener("click",function(e){var i=n(document,"tiled-export-naming-rule");if(!(i instanceof HTMLSelectElement))throw new Error("#tiled-export-naming-rule is not SELECT");var r=n(document,"tiled-export-format");if(!(r instanceof HTMLSelectElement))throw new Error("#tiled-export-format is not SELECT");var a=n(document,"tiled-export-usetsx");if(!(a instanceof HTMLSelectElement))throw new Error("#tiled-export-usetsx is not SELECT");var o=n(document,"tiled-export-compress");if(!(o instanceof HTMLSelectElement))throw new Error("#tiled-export-compress is not SELECT");var s=i.value.split(","),l=r.value.split(","),d="yes"===a.value,c="deflate"===o.value;if(2!==s.length||2!==l.length)throw new Error("tiled export form data is invalid");t.exportFaviewTiled(s[0],"flat"===s[1],l[0],l[1],c,d)},!1),n(document,"export-layer-structure").addEventListener("click",function(e){saveAs(new Blob([t.layerRoot.text],{type:"text/plain"}),"layer.txt")},!1);for(var s=document.querySelectorAll(".psdtool-toggle-tree-faview"),a=0;a<s.length;++a)s[a].addEventListener("click",function(e){return t.toggleTreeFaview()},!1);this.faviewSettingDialog=new h(this.favorite),this.faviewSettingDialog.onUpdate=function(){return t.favorite.updateLocalStorage()}},e.prototype.toggleTreeFaview=function(e){var t=n(document,"layer-tree-pane");void 0===e&&(e=!t.classList.contains("faview-active")),e?(t.classList.add("faview-active"),this.faviewOnRootChanged()):t.classList.remove("faview-active")},e.prototype.startFaview=function(){var e=this;if(this.resized(),!this.faview){var t=void 0,i=void 0,r=n(document,"faview-root-node");if(!(r instanceof HTMLSelectElement))throw new Error("element not found: #faview-root-node");t=r;var r=n(document,"faview-tree");if(!(r instanceof HTMLUListElement))throw new Error("element not found: #faview-tree");i=r,this.faview=new o.Faview(this.favorite,t,i),this.faview.onRootChanged=function(){return e.faviewOnRootChanged()},this.faview.onChange=function(t){return e.faviewOnChange(t)}}n(document,"layer-tree-toolbar").classList.remove("hidden"),this.faview.start(),this.needRefreshFaview=!1,0===this.faview.roots?this.endFaview():this.resized()},e.prototype.refreshFaview=function(){this.faview&&!this.faview.closed||this.startFaview(),this.needRefreshFaview&&(this.faview.refresh(),this.needRefreshFaview=!1,0===this.faview.roots&&this.endFaview())},e.prototype.faviewOnRootChanged=function(){this.leaveReaderMode();for(var e=0,t=this.faview.getActive();e<t.length;e++){var i=t[e];this.layerRoot.deserializePartial(void 0,i.data.value,this.favorite.getFirstFilter(i))}this.redraw()},e.prototype.faviewOnChange=function(e){this.leaveReaderMode(e.data.value,this.favorite.getFirstFilter(e))},e.prototype.endFaview=function(){n(document,"layer-tree-toolbar").classList.add("hidden"),this.toggleTreeFaview(!1),this.resized(),this.faview.close()},e.prototype.exportZIP=function(t){var i=this,n=[],r=[],o=[],s=function(t){for(var i=0,a=t;i<a.length;i++){var l=a[i];switch(r.push(e.cleanForFilename(l.text.replace(/^\*/,""))),l.type){case"root":r.pop(),s(l.children),r.push("");break;case"folder":n.unshift(l),s(l.children),n.shift();break;case"filter":n.unshift(l),s(l.children),n.shift();break;case"item":for(var d=void 0,c=0,h=n;c<h.length;c++){var u=h[c];if("filter"===u.type){d=u.data.value;break}}d?o.push({name:r.join("\\")+".png",value:l.data.value,filter:d}):o.push({name:r.join("\\")+".png",value:l.data.value});break;default:throw new Error("unknown item type: "+l.type)}r.pop()}},l=this.favorite.json;s(l);var c=this.layerRoot.serialize(!0),h=new a.Zipper,u=new d("Exporting...",""),f=!1,p=function(e,t){h.dispose(function(e){}),console.error(t),f||alert(e+": "+t),u.close()};window.addEventListener("unload",function(){f=!0},!1);var m=0,v=function(){return++m<o.length+1?void u.update(m/(o.length+1),1===m?"drawing...":"("+m+"/"+o.length+") "+o[m-1].name):(i.layerRoot.deserialize(c),u.update(1,"building a zip..."),void h.generate(function(t){u.close(),saveAs(t,e.cleanForFilename(i.favorite.rootName)+".zip"),h.dispose(function(e){})},function(e){return p("cannot create a zip archive",e)}))};h.init(function(){h.addCompress("favorites.pfv",new Blob([i.favorite.pfv],{type:"text/plain; charset=utf-8"}),v,function(e){return p("cannot write pfv to a zip archive",e)});var n=0,r=function(){"filter"in o[n]?i.layerRoot.deserializePartial(t?"":c,o[n].value,o[n].filter):i.layerRoot.deserialize(o[n].value),i.render(function(t,i){1===t&&(h.add(o[n].name,new Blob([e.dataSchemeURIToArrayBuffer(i.toDataURL())],{type:"image/png"}),v,function(e){return p("cannot write png to a zip archive",e)}),++n<o.length&&setTimeout(r,0))})};r()},function(e){return p("cannot create a zip archive",e)})},e.prototype.exportFaview=function(t,i){var n=this,r=new a.Zipper,o=new d("Exporting...",""),s=!1,l=function(e,t){r.dispose(function(e){}),o.close(),console.error(t),s||alert(e+": "+t)};window.addEventListener("unload",function(){s=!0},!1),r.init(function(){n.enumerateFaview(function(n,a,s,d){var c=n.map(function(i,n){return e.cleanForFilename((n&&t?i.caption+"-":"")+i.name)}).join(i?"_":"\\")+".png";r.add(c,new Blob([e.dataSchemeURIToArrayBuffer(a.toDataURL())],{type:"image/png"}),d,function(e){return l("cannot write png to a zip archive",e)}),o.update(s,c)},function(){o.update(1,"building a zip..."),r.generate(function(e){saveAs(e,"simple-view.zip"),r.dispose(function(e){}),o.close()},function(e){return l("cannot create a zip archive",e)})})},function(e){return l("cannot create a zip archive",e)})},e.prototype.exportFaviewTiled=function(t,i,n,r,o,s){var c,h=this;switch(n){case"tmx":c="tmx";break;case"json":c="json";break;case"js":c="js";break;case"raw":switch(r){case"csv":c="csv";break;case"bin":c="bin"}}var u=new a.Zipper,f=new l.Tileder,p=new d("Exporting...",""),m=!1,v=function(e,t){u.dispose(function(e){}),p.close(),console.error(t),m||alert(e+": "+t)};window.addEventListener("unload",function(){m=!0},!1);var g=0,y=0,w=!1,b=function(){++y,w&&y===g&&(p.update(1,"building a zip..."),u.generate(function(e){saveAs(e,"tiled.zip"),u.dispose(function(e){}),p.close()},function(e){return v("cannot create a zip archive",e)}))};u.init(function(){h.enumerateFaview(function(n,r,a,o){var s=n.map(function(i,n){switch(t){case"standard":return e.cleanForFilename((n?i.caption+"-":"")+i.name);case"compact":return e.cleanForFilename(i.name);case"index":return i.index}}).join(i?"_":"\\");p.update(a/2,s),f.add(s,r,o)},function(){f.finish("binz"===r,function(t,i){++g,u.add(t.filename+".png",new Blob([e.dataSchemeURIToArrayBuffer(t.getImage(document).toDataURL())],{type:"image/png"}),function(){p.update(.5,t.filename+".png"),b(),s&&(++g,u.addCompress(t.filename+".tsx",new Blob([t["export"]()],{type:"text/xml; charset=utf-8"}),function(){p.update(.5,t.filename+".tsx"),b()},function(e){return v("cannot write tsx to a zip archive",e)}))},function(e){return v("cannot write png to a zip archive",e)})},function(e,t){var i=o?u.addCompress:u.add;i=i.bind(u),++g,i(e.name+"."+c,e["export"](n,r,s),function(){p.update(t/2+.5,e.name+"."+c),b()},function(e){return v("cannot write file to a zip archive",e)})},function(){++g,w=!0,b()})});var a={format:c,flatten:i,namingStyle:t,roots:h.faview.items.map(function(t){return{name:t.name,captions:t.selects.map(function(t){return e.cleanForFilename(t.caption)}),selects:t.selects.map(function(t){return t.items.map(function(t){return e.cleanForFilename(t.name)})})}})};"js"===n?(++g,u.addCompress("faview.js",new Blob(["onFaviewLoaded(",JSON.stringify(a),");"],{type:"text/javascript; charset=utf-8"}),function(){return b()},function(e){return v("cannot write faview.js to a zip archive",e)}),++g,u.addCompress("viewer.html",new Blob([l.getViewer()],{type:"text/html; charset=utf-8"}),function(){return b()},function(e){return v("cannot write viewer.html to a zip archive",e)})):(++g,u.addCompress("faview.json",new Blob([JSON.stringify(a)],{type:"application/json; charset=utf-8"}),function(){return b()},function(e){return v("cannot write faview.json to a zip archive",e)}))},function(e){return v("cannot create a zip archive",e)})},e.prototype.enumerateFaview=function(e,t){var i=this;this.refreshFaview();for(var n=this.faview.items,r=0,a=0,o=n;a<o.length;a++){var s=o[a];if(s.selects.length){for(var l=1,d=0,c=s.selects;d<c.length;d++){var h=c[d];l*=h.items.length}r+=l}}if(r){var u,f=this.layerRoot.serialize(!0),p=0,m=[],v=function(t,n,a){var o=u[t],s=o.items[n];m.push({caption:o.caption,name:s.name,index:n});var l=i.favorite.get(s.value);i.layerRoot.deserializePartial(void 0,l.data?l.data.value:"",i.favorite.getFirstFilter(l));var d=function(){m.pop(),n<o.items.length-1?v(t,n+1,a):a()};t<u.length-1?u[t+1].items.length?v(t+1,0,d):d():i.render(function(t,i){1===t&&e(m,i,++p/r,d)})},g=function(e,t){var i=n[e];m.push({caption:"root",name:i.name,index:e}),u=i.selects;var r=function(){m.pop(),++e>=n.length?t():g(e,t)};u.length&&u[0].items.length?v(0,0,r):r()};g(0,function(){i.layerRoot.deserialize(f),t()})}},e.prototype.initUI=function(){var t=this;this.optionAutoTrim=e.getInputElement("#option-auto-trim"),this.optionSafeMode=e.getInputElement("#option-safe-mode");var i=document.querySelectorAll(".psdtool-tab-toolbar");this.sideBody=n(document,"side-body"),this.sideBody.addEventListener("scroll",function(e){for(var n=t.sideBody.scrollTop+"px",r=0;r<i.length;++r){var a=i[r];a instanceof HTMLElement&&(a.style.top=n)}},!1),this.sideBodyScrollPos={},jQuery('a[data-toggle="tab"]').on("hide.bs.tab",function(e){var i=e.target.getAttribute("href");t.sideBodyScrollPos[i]={left:t.sideBody.scrollLeft,top:t.sideBody.scrollTop}}).on("shown.bs.tab",function(e){var i=e.target.getAttribute("href");i in t.sideBodyScrollPos&&(t.sideBody.scrollLeft=t.sideBodyScrollPos[i].left,t.sideBody.scrollTop=t.sideBodyScrollPos[i].top),t.resized()}),jQuery('a[data-toggle="tab"][href="#layer-tree-pane"]').on("show.bs.tab",function(e){t.leaveReaderMode(),t.refreshFaview()}),this.initFavoriteUI(),this.previewBackground=n(document,"preview-background");var r=n(document,"preview");if(!(r instanceof HTMLCanvasElement))throw new Error("element not found: #preview");this.previewCanvas=r,this.previewCanvas.addEventListener("dragstart",function(e){var i=t.previewCanvas.toDataURL(),n=t.previewCanvas.getAttribute("data-filename");if(n){var r=i.indexOf(";");i=i.substring(0,r)+";filename="+encodeURIComponent(n)+i.substring(r)}e.dataTransfer.setData("text/uri-list",i),e.dataTransfer.setData("text/plain",i)},!1),jQuery("#main").on("splitpaneresize",function(e){return t.resized()}).splitPane();var a=n(document,"flip-x");a instanceof HTMLInputElement&&(this.flipX=a),jQuery(this.flipX).on("change",function(e){return t.redraw()});var o=n(document,"flip-y");o instanceof HTMLInputElement&&(this.flipY=o),jQuery(this.flipY).on("change",function(e){return t.redraw()});var s=n(document,"fixed-side");if(!(s instanceof HTMLSelectElement))throw new Error("element not found: #fixed-side");this.fixedSide=s,this.fixedSide.addEventListener("change",function(e){return t.redraw()},!1);var l;this.maxPixels=e.getInputElement("#max-pixels"),this.maxPixels.addEventListener("blur",function(i){var n=e.normalizeNumber(t.maxPixels.value);n!==l&&(l=n,t.maxPixels.value=n,t.redraw())},!1),this.seqDlPrefix=e.getInputElement("#seq-dl-prefix"),this.seqDlNum=e.getInputElement("#seq-dl-num");var d=n(document,"seq-dl");if(!(d instanceof HTMLButtonElement))throw new Error("element not found: #seq-dl");this.seqDl=d,this.seqDl.addEventListener("click",function(i){var n=t.seqDlPrefix.value;if(""===t.seqDlNum.value)return void t.save(n+".png");var r=parseInt(e.normalizeNumber(t.seqDlNum.value),10);0>r&&(r=0),t.save(n+("0000"+r).slice(-4)+".png"),t.seqDlNum.value=(r+1).toString()},!1),Mousetrap.pause()},e.prototype.redraw=function(){var e=this;this.seqDl.disabled=!0,this.render(function(t,i){e.previewBackground.style.width=i.width+"px",e.previewBackground.style.height=i.height+"px",e.seqDl.disabled=1!==t,e.previewCanvas.draggable=1===t,setTimeout(function(){e.previewCanvas.width=i.width,e.previewCanvas.height=i.height,e.previewCanvas.getContext("2d").drawImage(i,0,0)},0)}),this.layerRoot.updateClass()},e.prototype.save=function(t){saveAs(new Blob([e.dataSchemeURIToArrayBuffer(this.previewCanvas.toDataURL())],{type:"image/png"}),t)},e.prototype.loadRenderer=function(e){this.renderer=new r.Renderer(e);var t=this.layerRoot.nodes,i=this.renderer.nodes;for(var n in i)i.hasOwnProperty(n)&&!function(e,t){e.getVisibleState=function(){return t.checked}}(i[n],t[n])},e.prototype.render=function(e){var t=this.optionAutoTrim.checked,i=t?this.renderer.Width:this.renderer.CanvasWidth,n=t?this.renderer.Height:this.renderer.CanvasHeight,r=parseInt(this.maxPixels.value,10),a=1;switch(this.fixedSide.value){case"w":i>r&&(a=r/i);break;case"h":n>r&&(a=r/n)}(1>i*a||1>n*a)&&(a=i>n?1/n:1/i);var o,s;this.flipX.checked?this.flipY.checked?(o=3,s=3):(o=1,s=1):this.flipY.checked?(o=2,s=2):(o=0,s=0),this.layerRoot.flip!==o&&(this.layerRoot.flip=o),this.renderer.render(a,t,s,e)},e.prototype.initLayerTree=function(){var e=this,t=n(document,"layer-tree");if(!(t instanceof HTMLUListElement))throw new Error("#layer-tree is not an UL element");this.layerTree=t,this.layerTree.innerHTML="",this.layerTree.addEventListener("click",function(t){var i=t.target;if(i instanceof HTMLInputElement&&i.classList.contains("psdtool-layer-visible")){var n=e.layerRoot.nodes[parseInt(i.getAttribute("data-seq")||"0",10)];i.checked&&(e.lastCheckedNode=n);for(var r=n.parent;!r.isRoot;r=r.parent)r.checked=!0;n.clippedBy&&(n.clippedBy.checked=!0),e.redraw()}},!1)},e.prototype.loadLayerTree=function(e){this.layerTree||this.initLayerTree(),this.layerRoot=new s.LayerTree(this.optionSafeMode.checked,this.layerTree,e)},e.prototype.enterReaderMode=function(e,t,i){this.previewBackground.classList.contains("reader")||(this.previewBackground.classList.add("reader"),this.normalModeState=this.layerRoot.serialize(!0)),t?this.layerRoot.deserializePartial(this.normalModeState,e,t):this.layerRoot.deserialize(e),i&&this.previewCanvas.setAttribute("data-filename",i),this.redraw()},e.prototype.leaveReaderMode=function(e,t){if(this.previewBackground.classList.contains("reader")&&this.previewBackground.classList.remove("reader"),e)this.previewCanvas.removeAttribute("data-filename"),t?this.normalModeState?this.layerRoot.deserializePartial(this.normalModeState,e,t):this.layerRoot.deserializePartial(void 0,e,t):this.layerRoot.deserialize(e);else{if(!this.normalModeState)return;this.previewCanvas.removeAttribute("data-filename"),this.layerRoot.deserialize(this.normalModeState)}this.redraw(),this.normalModeState=null},e.getInputElement=function(e){var t=document.querySelector(e);if(t instanceof HTMLInputElement)return t;throw new Error("element not found "+e)},e.cleanForFilename=function(e){return e.replace(/[\x00-\x1f\x22\x2a\x2f\x3a\x3c\x3e\x3f\x7c\x7f]+/g,"_")},e.formateDate=function(e){var t=e.getFullYear()+"-";return t+=("0"+(e.getMonth()+1)).slice(-2)+"-",t+=("0"+e.getDate()).slice(-2)+" ",t+=("0"+e.getHours()).slice(-2)+":",t+=("0"+e.getMinutes()).slice(-2)+":",t+=("0"+e.getSeconds()).slice(-2)},e.extractFilePrefixFromUrl=function(e){return e=e.replace(/#[^#]*$/,""),e=e.replace(/\?[^?]*$/,""),e=e.replace(/^.*?([^\/]+)$/,"$1"),e=e.replace(/\..*$/i,"")+"_"},e.initDropZone=function(e,t){var i=n(document,e);i.addEventListener("dragenter",function(e){return i.classList.add("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("dragover",function(e){return i.classList.add("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("dragleave",function(e){return i.classList.remove("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("drop",function(e){return i.classList.remove("psdtool-drop-active"),e.dataTransfer.files.length>0&&t(e.dataTransfer.files),e.preventDefault(),e.stopPropagation(),!1},!1);var r=i.querySelector("input[type=file]");if(r instanceof HTMLInputElement){var a=r;r.addEventListener("change",function(e){t(a.files),a.value=null},!1)}},e.dataSchemeURIToArrayBuffer=function(e){for(var t=atob(e.substring(e.indexOf(",")+1)),i=new Uint8Array(t.length),n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i.buffer},e.normalizeNumber=function(e){return e.replace(/[\uff10-\uff19]/g,function(e){return(e[0].charCodeAt(0)-65296).toString()})},e.loadAsBlobCrossDomain=function(t,i){var n=m.deferred();if("https:"===location.protocol&&"http:"===i.substring(0,5))return setTimeout(function(){return n.reject(new Error("cannot access to the insecure content from HTTPS."))},0),n.promise;var r,a=document.createElement("iframe"),o=setTimeout(function(){r.onmessage=null,document.body.removeChild(a),n.reject(new Error("something went wrong"))},2e4);return a.setAttribute("sandbox","allow-scripts allow-same-origin"),a.onload=function(s){var l=new MessageChannel;r=l.port1,r.onmessage=function(r){if(o&&(clearTimeout(o),o=0),r.data&&r.data.type)switch(r.data.type){case"complete":return document.body.removeChild(a),r.data.data?(t(1),void n.resolve({buffer:r.data.data,name:r.data.name?r.data.name:e.extractFilePrefixFromUrl(i)})):void n.reject(new Error("something went wrong"));case"error":return document.body.removeChild(a),void n.reject(new Error(r.data.message?r.data.message:"could not receive data"));case"progress":return void("loaded"in r.data&&"total"in r.data&&t(r.data.loaded/r.data.total))}},a.contentWindow.postMessage(location.protocol,i.replace(/^([^:]+:\/\/[^\/]+).*$/,"$1"),[l.port2])},a.src=i,a.style.display="none",document.body.appendChild(a),n.promise},e.loadAsBlobFromString=function(t,i){if("xd:"===i.substring(0,3))return this.loadAsBlobCrossDomain(t,i.substring(3));var n=m.deferred(),r=new XMLHttpRequest;return r.open("GET",i),r.responseType="blob",r.onload=function(a){return t(1),200===r.status?void n.resolve({buffer:r.response,name:e.extractFilePrefixFromUrl(i)}):void n.reject(new Error(r.status+" "+r.statusText))},r.onerror=function(e){console.error(e),n.reject(new Error("could not receive data"))},r.onprogress=function(e){return t(e.loaded/e.total)},r.send(null),n.promise},e.loadAsBlob=function(e,t){if(t instanceof File){var i=t,n=m.deferred();return setTimeout(function(){n.resolve({buffer:i,name:i.name.replace(/\..*$/i,"")+"_"})},0),n.promise}return this.loadAsBlobFromString(e,t)},e}();i.Main=u,function(){var e=Mousetrap.prototype.stopCallback;Mousetrap.prototype.stopCallback=function(t,i,n){return this.paused||!i.classList.contains("psdtool-layer-visible")&&!i.classList.contains("psdtool-faview-select")?e.call(this,t,i,n):!1},Mousetrap.init()}();var f=new u;document.addEventListener("DOMContentLoaded",function(e){return f.init()},!1)},{"./favorite":4,"./layertree":5,"./renderer":7,"./tileder":8,"./zipper":9}],7:[function(e,t,i){"use strict";var n=e("./blend/blend"),r=e("./downscaler");!function(e){e[e.NoFlip=0]="NoFlip",e[e.FlipX=1]="FlipX",e[e.FlipY=2]="FlipY",e[e.FlipXY=3]="FlipXY"}(i.FlipType||(i.FlipType={}));var a=(i.FlipType,function(){function e(e,t){var i=this;if(this.layer=e,this.parent=t,this.getVisibleState=function(){return i.layer.Visible},this.state="",this.nextState="",this.children=[],!e)return void(this.id=-1);this.id=e.SeqID;var n=e.Width,r=e.Height;0>=n*r||(this.buffer=document.createElement("canvas"),this.buffer.width=n,this.buffer.height=r)}return Object.defineProperty(e.prototype,"visible",{get:function(){return this.getVisibleState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateHash",{get:function(){return e.calcHash(this.state).toString(16)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextStateHash",{get:function(){return e.calcHash(this.nextState).toString(16)},enumerable:!0,configurable:!0}),e.calcHash=function(e){if(0===e.length)return 0;for(var t,i=0,n=0;n<e.length;++n)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i},e}());i.Node=a;var o=function(){function e(e){this.psd=e,this.canvas=document.createElement("canvas"),this.root=new a(void 0,void 0),this.nodes={},this.buildTree(this.root,e),this.root.buffer=document.createElement("canvas"),this.root.buffer.width=e.Width,this.root.buffer.height=e.Height,this.registerClippingGroup(this.root)}return e.prototype.draw=function(e,t,i,r,a,o){switch(o){case"clear":case"copy":case"destination":case"source-over":case"destination-over":case"source-in":case"destination-in":case"source-out":case"destination-out":case"source-atop":case"destination-atop":case"xor":return e.globalAlpha=a,e.globalCompositeOperation=o,void e.drawImage(t,i,r)}n.blend(e.canvas,t,i,r,t.width,t.height,a,o)},e.prototype.clear=function(e){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,e.canvas.width,e.canvas.height)},Object.defineProperty(e.prototype,"Width",{get:function(){return this.psd.Width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Height",{get:function(){return this.psd.Height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanvasWidth",{get:function(){return this.psd.CanvasWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanvasHeight",{get:function(){return this.psd.CanvasHeight},enumerable:!0,configurable:!0}),e.prototype.buildTree=function(e,t){for(var i,n=0,r=t.Children;n<r.length;n++){var o=r[n];i=new a(o,e),this.buildTree(i,o),e.children.push(i),this.nodes[i.id]=i}},e.prototype.registerClippingGroup=function(e){for(var t=[],i=void 0,n=e.children.length-1;n>=0;--n)if(i=e.children[n],this.registerClippingGroup(i),i.layer.Clipping)t.unshift(i);else{if(t.length){for(var r=0,a=t;r<a.length;r++){var o=a[r];o.clippedBy=i}i.clippingBuffer=document.createElement("canvas"),i.clippingBuffer.width=i.layer.Width,i.clippingBuffer.height=i.layer.Height,i.clip=t}t=[]}},e.prototype.render=function(e,t,i,n){var r=this,a=Date.now();this.root.nextState="";for(var o=0,s=this.root.children;o<s.length;o++){var l=s[o];l.layer.Clipping&&"pass-through"!==l.layer.BlendMode||this.calculateNextState(l,l.layer.Opacity/255,l.layer.BlendMode)&&(this.root.nextState+=l.nextStateHash+"+")}var d=this.root.buffer;if(this.root.state!==this.root.nextState){var c=d.getContext("2d");this.clear(c);for(var h=0,u=this.root.children;h<u.length;h++){var l=u[h];l.layer.Clipping&&"pass-through"!==l.layer.BlendMode||this.drawLayer(c,l,-this.psd.X,-this.psd.Y,l.layer.Opacity/255,l.layer.BlendMode)}this.root.state=this.root.nextState}console.log("rendering: "+(Date.now()-a)),a=Date.now(),this.downScale(d,e,function(o,s){console.log("scaling: "+(Date.now()-a)+"(phase:"+o+")");var l=t?r.psd.Width:r.psd.CanvasWidth,d=t?r.psd.Height:r.psd.CanvasHeight,c=r.canvas;c.width=0|l*e,c.height=0|d*e;var h=c.getContext("2d");if(!h)throw new Error("cannot get CanvasRenderingContext2D");switch(r.clear(h),h.save(),i){case 1:h.translate(c.width,0),h.scale(-1,1);break;case 2:h.translate(0,c.height),h.scale(1,-1);break;case 3:h.translate(c.width,c.height),h.scale(-1,-1)}h.drawImage(s,t?0:0|r.psd.X*e,t?0:0|r.psd.Y*e),h.restore(),n(o,c)})},e.prototype.downScale=function(e,t,i){if(1===t)return void i(1,e);var n=new r.DownScaler(e,t);i(0,n.fast()),setTimeout(function(){return n.beautifulWorker(function(e){return i(1,e)})},0)},e.prototype.calculateNextState=function(e,t,i){if(!e.visible||0===t)return!1;if(e.nextState="",e.layer.Children.length){"pass-through"===i&&(e.nextState+=e.parent.nextStateHash+"+");for(var n=0,r=void 0;n<e.layer.Children.length;++n)r=e.layer.Children[n],r.Clipping&&"pass-through"!==r.BlendMode||this.calculateNextState(e.children[n],r.Opacity/255,r.BlendMode)&&(e.nextState+=e.children[n].nextStateHash+"+")}else e.layer.Canvas&&(e.nextState=e.id.toString());if(e.layer.Mask&&(e.nextState+="|lm"),!e.clip||"pass-through"===i)return!0;if(e.nextState+="|cm"+(e.layer.BlendClippedElements?"1":"0")+":",e.layer.BlendClippedElements){for(var n=0,a=void 0;n<e.clip.length;++n)a=e.clip[n],this.calculateNextState(e.clip[n],a.layer.Opacity/255,a.layer.BlendMode)&&(e.nextState+=e.clip[n].nextStateHash+"+");return!0}e.nextState+=Date.now()+"_"+Math.random()+":";for(var o=0,s=e.clip;o<s.length;o++){var a=s[o];this.calculateNextState(a,1,"source-over")&&(e.nextState+=a.nextStateHash+"+")}return!0},e.prototype.drawLayer=function(e,t,i,n,r,a){if(!t.visible||0===r||!t.children.length&&!t.layer.Canvas)return!1;var o=t.buffer;if(t.state===t.nextState)return"pass-through"===a?this.draw(e,o,i+t.layer.X,n+t.layer.Y,1,"source-over"):this.draw(e,o,i+t.layer.X,n+t.layer.Y,r,a),!0;var s=o.getContext("2d");if(!s)throw new Error("cannot get CanvasRenderingContext2D for BackBuffer");if(this.clear(s),t.children.length)if("pass-through"===a){this.draw(s,t.parent.buffer,-i-t.layer.X,-n-t.layer.Y,1,"source-over");for(var l=0,d=t.children;l<d.length;l++){var c=d[l];c.layer.Clipping&&"pass-through"!==c.layer.BlendMode||this.drawLayer(s,c,-t.layer.X,-t.layer.Y,c.layer.Opacity*r/255,c.layer.BlendMode)}}else for(var h=0,u=t.children;h<u.length;h++){var c=u[h];c.layer.Clipping&&"pass-through"!==c.layer.BlendMode||this.drawLayer(s,c,-t.layer.X,-t.layer.Y,c.layer.Opacity/255,c.layer.BlendMode)}else t.layer.Canvas&&this.draw(s,t.layer.Canvas,0,0,1,"source-over");if(t.layer.Mask&&this.draw(s,t.layer.Mask,t.layer.MaskX-t.layer.X,t.layer.MaskY-t.layer.Y,1,t.layer.MaskDefaultColor?"destination-out":"destination-in"),!t.clip||"pass-through"===a)return"pass-through"===a?this.draw(e,o,i+t.layer.X,n+t.layer.Y,1,"source-over"):this.draw(e,o,i+t.layer.X,n+t.layer.Y,r,a),t.state=t.nextState,!0;var f=t.clippingBuffer,p=f.getContext("2d");if(!p)throw new Error("cannot get CanvasRenderingContext2D for ClipBackBuffer");if(t.layer.BlendClippedElements){this.draw(p,o,0,0,1,"copy-opaque");for(var m=0,v=t.clip;m<v.length;m++){var c=v[m];c.layer.Clipping&&"pass-through"!==c.layer.BlendMode&&this.drawLayer(p,c,-t.layer.X,-t.layer.Y,c.layer.Opacity/255,c.layer.BlendMode)}return this.draw(p,o,0,0,1,"copy-alpha"),t.clippingBuffer=o,t.buffer=f,"pass-through"===a?this.draw(e,f,i+t.layer.X,n+t.layer.Y,1,"source-over"):this.draw(e,f,i+t.layer.X,n+t.layer.Y,r,a),t.state=t.nextState,!0}this.draw(e,o,i+t.layer.X,n+t.layer.Y,r,a),this.clear(p);for(var g=0,y=t.clip;g<y.length;g++){var c=y[g];this.drawLayer(p,c,-t.layer.X,-t.layer.Y,1,"source-over")&&(this.draw(p,o,0,0,1,"destination-in"),this.draw(e,f,i+t.layer.X,n+t.layer.Y,c.layer.Opacity/255,c.layer.BlendMode),this.clear(p))}return t.state=t.nextState,!0},e}();i.Renderer=o},{"./blend/blend":1,"./downscaler":3}],8:[function(e,t,i){"use strict";function n(e,t,i){for(var n=new Array(e.length),r=0;r<e.length;++r)n[r]='<tile gid="'+e[r].toString()+'"/>';return t+n.join(t+i)+i}function r(e,t,i){for(var n=new Array(e.length-e.length/(t-1)|0),r=0,a=0,o=0;r<e.length;++r,++a,++o)o+1===t&&r+1<e.length?(n[a]=e[r].toString()+i+e[++r].toString(),o=0):n[a]=e[r].toString();return n.join(",")}function a(){return'<!DOCTYPE html>\n<meta charset="utf-8">\n<title>Tiled Viewer</title>\n<style>\nbody{margin:0}\n#ui,#view{float:left}\n#selects{padding:0 0.5em}\n#selects li{padding:0;margin:0 0 1em 0;list-style:none}\n#selects select,input[type=range]{display:block;margin: 2px 0;min-width:192px}\n#view{background-image: url(data:image/gif;base64,R0lGODlhYABgAKEBAMzMzP///////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQACgD/ACwAAAAAYABgAAAC/oxvoKuIzNyBSyYKbMDZcv15GDiKFHmaELqqkVvBjdxJoV3iqd7yrx8DzoQ1x82YQ+6UPebPGYQOpcVH0rrENrVPbtQ7BVcnV3LWvEV31V922D2+cM7ydH19b+ff+/im3MeC90dHaGc4eCQmqIfYqAjHyOc4CRlII+lnSakJyJkJiilKFEo6SlWKerq4Gtl6aRqrqiHLWut6Czu7a8uL66vbK/w7HEx8bJz8+bqc2wz8XByNPK28ee2JXah9yJ2YDb4dPvctbt49Xo5+rt7+mP7OHr9O714Jfy+fXz9v36n/j98+f6mkeeuHcGDCgASZHVQI0U9Bag8ZLpxoDZ/F+ogYq3ms2BGkQ40hSY4EWBLlSYEbW6Zk+bKhM5EzycFcKRMaTZ0ma6r0eRNoToM9ef40GhTpUIpFiR51mhTq0oxPqcW8iBOrUK1KuUr1yrQq1ahhyY6d+rFpWbQ7v3LM+nZr3K5zxbRdC/Zs3rRi+Zr1y1at3rp4CQ92CRexXMV0Gbt1XBjy4auGad2dnJiyZMB7L3Ou7Dm04M+bRfc1/Rd14NOjVXfW6Bp069msa6emfdv26ty8d/t+rRt4b+G/ZQevrDl55uWLlTdn3th5dOiPpVenHtl6duyYn3tvHLs07uLij5cfbhz9efLau0//fh3+dvnu47+HVgAAIfkEAQoAAgAsAAAAAGAAYAAAAv4MjhfLm9naQ5FNVc3NembAXeC3kZ75hGUlqie7Ri0K0ZSNwa8cS731cwQ7KdxIV0TWlDdmjrfzRYFTYZW4hCa1WenW26V+xWHr2FzGNrlrcJv8RsfVT3cdfpfn6Uf2fjPj1Gc3iFeod8jncqZotJgW6JcYSfg4R2lo+TeEiag5yRl61dko+HnqmGqqKom6+trKWimbSetpWxor46rbOwv761sLPCx8S3xsnBvMXNyc/LzsPA1NLV2Nfa1Nyi3K2D3qDSl+Sb4Zjv7tAa6ePu5eDn/eTv9eH38/b7+Pz6/fD/CfQFDyCOYz6A9hQIUDeUVjl9ChNYgLJWbrxDCjxf1t5jTiotjwY8eNID0i41iQ5EiRKVkeVNnyZEmYL11GtFkRJ4iZOk0q4ylzZdCYP4UWJfrQaFKkE5U2ZXrRaVSoKGsOtXoU6zOfS7U+9ToVbNWbV8lmNdsV7Ve1YdmOzVkW7lm5aemutdsW79udUvdyvRsybuC5g+sWBvw372HFif3SdAuUcOPIhif3pYzYomWqmBk/1tvZcc/Pi0UL3iw2tOrLrDm3Tv0acuyApiWTRi3btW7Yu3Pz/u07OOjZpVf3Hn68OHHccZgrT+48+u3po6ufpn7dum3tlbFvzw7+u/juOmuTD39+fGbu69G3V++ZfXz38+Gbf58+/4ICACH5BAEKAAMALAAAAABgAGAAAAL+TICJxqza2kvRTVDNxXnnc31eF5KTWFajxKlptMIve5oPWru5vNO3DQFShAtii/fTJZFBZZM5dEahRWmVevQ9tVPu1Zu19MRLMK5M3qa76287rJm9z+r42I7G10F3ft6/F2NmRMemxyE4R7hoBQdo+Oh2KBnpmDhpKYdZSHlZyZnZ5zmq+cmIBZp6Otio2rqq+CqLCrtZazrLSpsbu+urG+f62wtMbGzLizysXMx8jLsM3Sz9TCpaav2XHYjdff2t7R0Ozk0OuX0uXj7Ovu6eHoTeqQ7fXv8+b55vv48fyv/Pn7Bp8gLeO9gPocGEDBc6HFiNXkOIzipSs1iQ4sX8jYkm3sr4UeLDkPpGJuMoUiPIkyujtSSYkiRAlTFZ1nR5E2ZJmjtlFnkZsadNoTiJ6pzpUyFPpEOZFnV6VGBSj02lVlU61eRTq1ux8qLaFWxUr2G1jhUbFGparmfNriXbdinbt2gx5qTr1q5RvHLhrtGrFvBcwX4J10W513BexIEZD3ZcGPJhoIr7Tr5bOavlxUAvJ5bMGTPozaQ1m77quTHl0afLlkYd+vPq2aJpm8sM+7Xr1nF58/WNe3du4KyHGxeOvPdx5cl/Lwehm7l0582DT7dO/Xrx6tu121ZdO7xs8eDHm7eHPX337OzVf3/8PnL81PDJ1z9/X20BACH5BAEKAAMALAAAAABgAGAAAAL+jIGJxqza2kvRTVDPzeHi7HEhuJGTWFajmkar20qxdZoP/LG1ftuQTwEuhDlcj/dDBpVDZlG2MyalS2rT+qQdsagodPudhqvjazmr8WrFa3Lb/EZ3ZmlwvGuvs/VuPtwv93KGtzenBkjYZ5i3WCh45wPplPjXqPiISEQZSGdZienJeRi6Wap5OonKpTrIKrmaGgs72ypbS/t6q5vLm2nbS+rqizuse9kJmoy8PKrczMzoHA3tSH38jD2dXb19rf3NDe4dTj5u/mmN3q0uzl7ufi7aLv9ODyxdb/pbfJ9OH6+PWLB9AwXiAyis4C5+DBX2W/cPnsSIFAMudNjw4ET7iw/ncSyGkKDGiglHfsSI0mRJfydVimS5EmJLmC9lxvR4M1/OkAZp9rRZs4nLnziD6jTK8+JQpT6ZAiV6FGrSjlGdFpW6cWdWpFuxkuT6ldbUjE2pjk1ZluxTq1XNdmV7dqnbsHDfzp259q5WunrB4r0apq/Xv23VAhZcl6/hwmjzLo6btvHhx3YpK5bMWK5lwpAdK+w8GTPozJE1i658+rLp1aVbe2b92nVo2LNlk469DbHuzXs5o6Z9uzZu4cSDGx+N/Lft5KqXKx9+3Axz382hT++N3W/2wdsTU//efXdq8NrLczfvPad44NfRr3devXj78/TTu+fNoAAAIfkEAQoAAwAsAAAAAGAAYAAAAv6MA6l5javcgVE+ai/MlNkOcJ2IfaNZSiC5oa16wqmzugt725X80rE/a9QMOV4R2BP+lMHJ0tkkPqVRzZGZhGapW+sOedWGuWOvx/jFlofgtNhNhptDunPbrpaz8/h3P/43h6M3JVhHhxa454d418j3yDioWLgIGHnJAjmJaZjYaenpyEl6WPp5Omq6isqq2gr7KrvpShtrOytZq3vLm5u5C9wr/CuKe+yLTIy7VulcFRr93CUNPd1snU19TaiNve3dDT7+XS5uThmeTn7evo4Oyv3uHq9ezz6ff/+tbJz8vwygv4AEBxqshm8fvVT9EMJjKNDhwmAH5SnUB7GgRPyMFDde/Jixor2QbB52tEgS5cmRKxOmZDlMpMuWJmN6fDnTpkqdMIvdpDmRZ06fO5E0LHq0Z9KhS2sSVRoRaVSoGqVWpSrTadOgT5lO9XoVbFauWzlywan1a9qwa8ea7dr2p9C4Vt2CBPq27N25ZNX2ZfvXLtrAco36zXt4L1zCdQvrHYwYcGTBeBU/rgzZcuLMnDF75ju5MF2sjjd/Xhy6sWrSq8WWlqwZdmfQsSnTno269mvbhmWfvnz7t+ngxHPjBm5cuO/iyJsPT878ufPl0DUcl46d+nTe23d7bz3aNXjGrMuLNx8+Pfnz7Pll5/7+O/r16lPPt9+eawEAIfkEAQoAAwAsAAAAAGAAYAAAAv6MDal5HbvcgUoiCuzDGmfrdRw4SiFJiSkKqS0bwZXM0J9ZOie+8q8fA86ENeJNl2vskD3m7+cMRofTYvWoTE60l2bWuwV3oV9y2DyWltVndpq6hrflb2vcPsfXsXn+3uW2ISaIRhi4dOdnSLeo16iI2AfIGPlnM+lY+YgJybV5CcpzxUkaOmqaWGqkerqKKvlq6TrbWpsa+0l7qwvLK2vbC/y7K5xbrInsmTy4XNh8qFziHM1MPV2Nfa0Nnc29TWntLQ7eTf6dGW4+jl7Oft7ZDv/OSlwfbD98r5/Pb4zvv0/QsXTu1skzSC/gM3UMCzY8+DBhv4UOK0K0KBHgRPyCFztmpOgRF8iPHEnGMzkvDUqEIku2PPkypS+NNEfGZDnTZk6XO2H2lDnQZ1Cg/3QOxXk0IoqkGG8q/Ym0KE+mIaE+pbryqlShW4kqnNo16leuY71uJHvWbC61RsNqLSs2bdyaYOG+lXuXLlq9bOvibWoVMFangt0Wtnv47ODAVRc7NtwYctbEfOe2RRwZ8+TMfzlXznu58+bRhD3v6Ls39GfKqlv7XW36tevUsmvTvo06t2XbukHz3o1ldm/Wv33jBj489nHjyUkzdv5Yc2nokqdbfx6q+fXoordXxw6eO2zq0sN/Fy8cuXrm64kvd38NfXH47ZVrN1++VQEAIfkEAQoAAwAsAAAAAGAAYAAAAv6MD6l5Hbscgkw+CuylGmfrdZjIgaNZSiEKkS0bwYobq6edOiv+8rV+A+YaO2HP+CMGlcNJ01BkHqVJ59RahZ6em6uWG8XOZBXf2FxGntVp6trdFse/3m7W/pZ/0Ht2H/6nR5NHdxdWSIg3pxiIuHjIOPi4JEjWGGkpeQnJSem46YnJp0maaWozeupXmtq6qgrI+uoaC1tJezurW4v7Kcu7mws8LFzsa3vcKxqczLxM3Az9bDwdTb0CFtqZzV237a0d3m0oDj6e+E1+PrkO2v57Xa5uTj9vjy6P/45c3Z+uXw/gPXYBJyn7R3Cgu4ILFcKzBtFfvoQCK1K82NBiRvqMDyXuOzhxo8iOCEfyK0kyZMqPzrAxXPnypEqZLKWhpBkTZM14OyPe1Jmz5UygDnEWJaoR5lGhPSUi5Wg0aVSoT01WVSr16lSrTIPaHNp16demP8NmNUsVLdexMcmCZSuWp1e5cX2+pXsWbl68afX25bsWMNa/dt0anlsYsUdwWhurHRw4cd3Fk8v6jUx5r2TNmQl3xmxZ8FbIpEeb1nq48t3NnkOzBr36c2nHl2c/Pn2btmjdr23Xxv0bVe7hwYnvNt4b+PHizJc7T85btnLoyKVHd239dmrO2LvH9r699ffx4WGX9/08e3Pq69WnB6+403Xy8emr3lcAACH5BAEKAAMALAAAAABgAGAAAAL+jB+gq4jM3IFLGtosBjbhvoGfNkohSYkpCqktG8GVnJmlc9qr/vKxPwPWcLdHcXK8JD07YtP4REaVU2bPeYVmpVtq1/rDhrVjbmSZEwfVQ/La3Ta/5XFv2T7H18F5/j4Nx0EjKETIZhjocueHSNeo98io2AfoOPmHlllVCXkZySk56DkqWlpIemp6iLqqoZr4ahnbORuaetuKC6sry0vra5srvDvcW/x7HEy8bMyM7KzcLP08HU19bZ0Nuq3Z0r3IvflNOY4pfv4Vnl7+yc4KrQ7uXhtPji5/b7+eb77vj/9PH8CBAgv2I3jQYLtN9OYBq5cw4sKAEt9VgzgRYUb4hRaxYeyozWGyjw35baxYkuLJlSBJPhQJ7wPMizM91gxpsuVNlyN3+syZUqNOoC+J9jQaEylNpTaZ4lTZMihHqSiLQqXKEuvQq1aFav3adWrYqke5lvU6NmvarWjPil3102xSuUvpNrX7tO1cvXX53vWb9+1ewX0J/zUcmOxgxYUZH/4D1q3jxGolV158uXHmx5sps0XME/PnyaE1j+5cmvPp1aLiAk7tObJo2aZpq7Ydey1u2Lxdg/ZNGjhq4VF1G7fM+vhs5bWZ33aeG/lu4tOd9rZOHfp1qNmla+++3Lv48OSbjzdf/vl59emjt9/+GvzF6ng/FgAAOw==)}\n</style>\n<div id="ui">\n  <div id="root"></div>\n  <ul id="selects"></ul>\n</div>\n<canvas id="view"></canvas>\n<script>\nvar tileMapLoadedCallbacks = {};\nfunction onTileMapLoaded(name, data) {\n  if (!(name in tileMapLoadedCallbacks)) {\n    return;\n  }\n  tileMapLoadedCallbacks[name](data);\n  delete tileMapLoadedCallbacks[name];\n}\nfunction loadTileMap(url, callback){\n  var m = url.match(/\\..+$/);\n  switch (m && m[0]) {\n  case \'.json\':\n    var xhr = new XMLHttpRequest();\n    xhr.open(\'GET\', url, true);\n    xhr.onload = function(e) {\n      callback(JSON.parse(this.response));\n    };\n    xhr.send();\n    return;\n  case \'.js\':\n    tileMapLoadedCallbacks[url.replace(/\\//g, \'\\\\\').replace(/\\..+$/, \'\')] = callback;\n    var sc = document.createElement(\'script\');\n    sc.src = url;\n    document.body.appendChild(sc);\n    setTimeout(function(){\n      document.body.removeChild(sc);\n    }, 0);\n    return;\n  }\n  throw new Error(\'unsupported filetype: \'+url);\n}\nfunction decodeData(layer){\n  if (!(\'encoding\' in layer)) {\n    return layer.data;\n  }\n  switch (layer.encoding) {\n  case \'base64\':\n    var ab = base64ToArrayBuffer(layer.data);\n    if (\'compression\' in layer) {\n      switch (layer.compression) {\n      case \'zlib\':\n        ab = pako.inflate(ab).buffer;\n        break;\n      default:\n        throw new Error(\'unsupported compression: \'+layer.compression);\n      }\n    }\n    var i32a = new Int32Array(ab), r = new Array(i32a.length);\n    for (var i = 0; i < i32a.length; ++i) {\n      r[i] = i32a[i];\n    }\n    return r;\n  default:\n    throw new Error(\'unsupported encoding: \'+layer.encoding);\n  }\n}\nfunction base64ToArrayBuffer(s){\n  var bin = atob(s), u8a = new Uint8Array(bin.length);\n  for (var i = 0; i < bin.length; ++i) {\n    u8a[i] = bin.charCodeAt(i);\n  }\n  return u8a.buffer;\n}\nvar selectId = 0;\nfunction createSelect(caption, items, onChange){\n  var id = \'sel\' + (++selectId);\n\n  var label = document.createElement(\'label\');\n  label.textContent = caption;\n  label.htmlFor = id;\n\n  var sel = document.createElement(\'select\');\n  sel.id = id;\n  items.map(function(item, index){\n    var opt = document.createElement(\'option\');\n    opt.textContent = item;\n    opt.value = item;\n    sel.appendChild(opt);\n  });\n\n  var slider = document.createElement(\'input\');\n  slider.type = \'range\';\n  slider.max = items.length-1;\n  slider.value = 0;\n\n  sel.addEventListener(\'change\', function(e){\n    slider.value = sel.selectedIndex;\n    onChange(e);\n  }, false);\n  slider.addEventListener(\'input\', function(e){\n    sel.selectedIndex = slider.value;\n    var ev = document.createEvent("HTMLEvents");\n    ev.initEvent("change", false, true);\n    sel.dispatchEvent(ev);\n  }, false);\n\n  var li = document.createElement(\'li\');\n  li.appendChild(label);\n  li.appendChild(sel);\n  li.appendChild(slider);\n  return li;\n}\nfunction updateSelects(faview, rootIndex) {\n  var elem = document.getElementById(\'selects\');\n  elem.innerHTML = \'\';\n  function changed(){\n    updateCanvas(faview, document.getElementById(\'view\'));\n  }\n  var root = faview.roots[rootIndex];\n  root.selects.map(function(sel, i){\n    elem.appendChild(createSelect(root.captions[i], sel, changed));\n  });\n}\nfunction buildName(flatten, namingStyle, ext) {\n  var items = [], sels = document.querySelectorAll(\'select\');\n  for (var i = 0; i < sels.length; ++i){\n    switch (namingStyle) {\n    case \'standard\':\n      items.push(\n        (i ? document.querySelector("label[for=\'"+sels[i].id+"\']").textContent+\'-\' : \'\')+\n        sels[i].options[sels[i].selectedIndex].value\n      );\n      break;\n    case \'compact\':\n      items.push(sels[i].options[sels[i].selectedIndex].value);\n      break;\n    case \'index\':\n      items.push(sels[i].selectedIndex);\n      break;\n    }\n  }\n  return items.join(flatten ? \'_\' : \'/\') + \'.\' + ext;\n}\nfunction renderCanvas(tiled, canvas, images, layer){\n  var tsx = tiled.tilesets, tw = tiled.tilewidth, th = tiled.tileheight;\n  canvas.width = tiled.properties.originalwidth;\n  canvas.height = tiled.properties.originalheight;\n  var ctx = canvas.getContext(\'2d\');\n  var dx = 0, dy = 0, data = decodeData(layer);\n  for (var i = 0; i < data.length; ++i) {\n    var d = data[i]-1, img = 0;\n    while(d >= tsx[img].tilecount) {\n      d -= tsx[img++].tilecount;\n    }\n    var sx = d % tsx[img].columns, sy = (d - sx) / tsx[img].columns;\n    ctx.drawImage(images[img], sx * tw, sy * th, tw, th, dx * tw, dy * th, tw, th);\n    if (++dx == layer.width) {\n      dx = 0;\n      ++dy;\n    }\n  }\n}\nfunction updateCanvas(faview, canvas){\n  var path = buildName(faview.flatten, faview.namingStyle, faview.format);\n  loadTileMap(path, function(tiled){\n    var images, loading = 0;\n    function loaded(){\n      if (--loading) return;\n      tiled.layers.map(function(layer){\n        renderCanvas(tiled, canvas, images, layer);\n      });\n    }\n    images = tiled.tilesets.map(function(tsx){\n      ++loading;\n      var img = new Image();\n      img.src = path.replace(/[^\\/]+$/, \'\') + tsx.image.replace(/\\\\/g, \'/\');\n      img.onload = loaded;\n      return img;\n    });\n  });\n}\nfunction onFaviewLoaded(faview){\n  var sel = document.createElement(\'select\');\n  faview.roots.map(function(root){\n    var opt = document.createElement(\'option\');\n    opt.textContent = root.name;\n    opt.value = root.name;\n    sel.appendChild(opt);\n  });\n  sel.addEventListener(\'change\', function(e){\n    updateSelects(faview, e.currentTarget.selectedIndex);\n  }, false);\n  if (faview.roots.length <= 1) {\n    sel.style.display = \'none\';\n  }\n  document.getElementById(\'root\').appendChild(sel);\n  updateSelects(faview, 0);\n  updateCanvas(faview, document.getElementById(\'view\'));\n}\n</script>\n<script>\n/* pako 1.0.3 nodeca/pako */\n!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,i,n){function a(o,s){if(!i[o]){if(!t[o]){var f="function"==typeof require&&require;if(!s&&f)return f(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module \'"+o+"\'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return a(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),a);for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){var t,i,n,a,r,o;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,i=e.length;t<i;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,i,n,a){for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],2:[function(e,t,i){"use strict";function n(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i}var a=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new a.Buf8(256),f=0;f<256;f++)s[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;s[254]=s[254]=1,i.string2buf=function(e){var t,i,n,r,o,s=e.length,f=0;for(r=0;r<s;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(t=new a.Buf8(f),o=0,r=0;o<f;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},i.buf2binstring=function(e){return n(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,r,o,f=t||e.length,l=new Array(2*f);for(a=0,i=0;i<f;)if(r=e[i++],r<128)l[a++]=r;else if(o=s[r],o>4)l[a++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<f;)r=r<<6|63&e[i++],o--;o>1?l[a++]=65533:r<65536?l[a++]=r:(r-=65536,l[a++]=55296|r>>10&1023,l[a++]=56320|1023&r)}return n(l,a)},i.utf8border=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return i<0?t:0===i?t:i+s[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){"use strict";function n(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do a=a+t[n++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0}t.exports=n},{}],4:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,i){"use strict";function n(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}function a(e,t,i,n){var a=r,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return e^-1}var r=n();t.exports=a},{}],6:[function(e,t,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],7:[function(e,t,i){"use strict";var n=30,a=12;t.exports=function(e,t){var i,r,o,s,f,l,d,u,c,h,b,w,m,k,_,g,v,p,x,y,S,E,B,Z,A;i=e.state,r=e.next_in,Z=e.input,o=r+(e.avail_in-5),s=e.next_out,A=e.output,f=s-(t-e.avail_out),l=s+(e.avail_out-257),d=i.dmax,u=i.wsize,c=i.whave,h=i.wnext,b=i.window,w=i.hold,m=i.bits,k=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=k[w&g];t:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,0===x)A[s++]=65535&p;else{if(!(16&x)){if(0===(64&x)){p=k[(65535&p)+(w&(1<<x)-1)];continue t}if(32&x){i.mode=a;break e}e.msg="invalid literal/length code",i.mode=n;break e}y=65535&p,x&=15,x&&(m<x&&(w+=Z[r++]<<m,m+=8),y+=w&(1<<x)-1,w>>>=x,m-=x),m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=_[w&v];i:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,!(16&x)){if(0===(64&x)){p=_[(65535&p)+(w&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=n;break e}if(S=65535&p,x&=15,m<x&&(w+=Z[r++]<<m,m+=8,m<x&&(w+=Z[r++]<<m,m+=8)),S+=w&(1<<x)-1,S>d){e.msg="invalid distance too far back",i.mode=n;break e}if(w>>>=x,m-=x,x=s-f,S>x){if(x=S-x,x>c&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(E=0,B=b,0===h){if(E+=u-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}else if(h<x){if(E+=u+h-x,x-=h,x<y){y-=x;do A[s++]=b[E++];while(--x);if(E=0,h<y){x=h,y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}}else if(E+=h-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}for(;y>2;)A[s++]=B[E++],A[s++]=B[E++],A[s++]=B[E++],y-=3;y&&(A[s++]=B[E++],y>1&&(A[s++]=B[E++]))}else{E=s-S;do A[s++]=A[E++],A[s++]=A[E++],A[s++]=A[E++],y-=3;while(y>2);y&&(A[s++]=A[E++],y>1&&(A[s++]=A[E++]))}break}}break}}while(r<o&&s<l);y=m>>3,r-=y,m-=y<<3,w&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=r<o?5+(o-r):5-(r-o),e.avail_out=s<l?257+(l-s):257-(s-l),i.hold=w,i.bits=m}},{}],8:[function(e,t,i){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _.Buf32(we),t.distcode=t.distdyn=new _.Buf32(me),t.sane=1,t.back=-1,z):C}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,r(e)):C}function s(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?C:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,o(e))):C}function f(e,t){var i,n;return e?(n=new a,e.state=n,n.window=null,i=s(e,t),i!==z&&(e.state=null),i):C}function l(e){return f(e,_e)}function d(e){if(ge){var t;for(m=new _.Buf32(512),k=new _.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(S,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(E,e.lens,0,32,k,0,e.work,{bits:5}),ge=!1}e.lencode=m,e.lenbits=9,e.distcode=k,e.distbits=5}function u(e,t,i,n){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new _.Buf8(r.wsize)),n>=r.wsize?(_.arraySet(r.window,t,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),_.arraySet(r.window,t,i-n,a,r.wnext),n-=a,n?(_.arraySet(r.window,t,i-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}function c(e,t){var i,a,r,o,s,f,l,c,h,b,w,m,k,we,me,ke,_e,ge,ve,pe,xe,ye,Se,Ee,Be=0,Ze=new _.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return C;i=e.state,i.mode===X&&(i.mode=W),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,b=f,w=l,ye=z;e:for(;;)switch(i.mode){case D:if(0===i.wrap){i.mode=W;break}for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(2&i.wrap&&35615===c){i.check=0,Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0),c=0,h=0,i.mode=F;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=ce;break}if((15&c)!==U){e.msg="unknown compression method",i.mode=ce;break}if(c>>>=4,h-=4,xe=(15&c)+8,0===i.wbits)i.wbits=xe;else if(xe>i.wbits){e.msg="invalid window size",i.mode=ce;break}i.dmax=1<<xe,e.adler=i.check=1,i.mode=512&c?q:X,c=0,h=0;break;case F:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.flags=c,(255&i.flags)!==U){e.msg="unknown compression method",i.mode=ce;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ce;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=L;case L:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.time=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,Ze[2]=c>>>16&255,Ze[3]=c>>>24&255,i.check=v(i.check,Ze,4,0)),c=0,h=0,i.mode=H;case H:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=M;case M:if(1024&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0}else i.head&&(i.head.extra=null);i.mode=j;case j:if(1024&i.flags&&(m=i.length,m>f&&(m=f),m&&(i.head&&(xe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),_.arraySet(i.head.extra,a,o,m,xe)),512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,i.length-=m),i.length))break e;i.length=0,i.mode=K;case K:if(2048&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.name+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=P;case P:if(4096&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.comment+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.comment=null);i.mode=Y;case Y:if(512&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ce;break}c=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=X;break;case q:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}e.adler=i.check=n(c),c=0,h=0,i.mode=G;case G:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,N;e.adler=i.check=1,i.mode=X;case X:if(t===Z||t===A)break e;case W:if(i.last){c>>>=7&h,h-=7&h,i.mode=le;break}for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}switch(i.last=1&c,c>>>=1,h-=1,3&c){case 0:i.mode=J;break;case 1:if(d(i),i.mode=ie,t===A){c>>>=2,h-=2;break e}break;case 2:i.mode=$;break;case 3:e.msg="invalid block type",i.mode=ce}c>>>=2,h-=2;break;case J:for(c>>>=7&h,h-=7&h;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ce;break}if(i.length=65535&c,c=0,h=0,i.mode=Q,t===A)break e;case Q:i.mode=V;case V:if(m=i.length){if(m>f&&(m=f),m>l&&(m=l),0===m)break e;_.arraySet(r,a,o,m,s),f-=m,o+=m,l-=m,s+=m,i.length-=m;break}i.mode=X;break;case $:for(;h<14;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.nlen=(31&c)+257,c>>>=5,h-=5,i.ndist=(31&c)+1,c>>>=5,h-=5,i.ncode=(15&c)+4,c>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ce;break}i.have=0,i.mode=ee;case ee:for(;i.have<i.ncode;){for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.lens[Ae[i.have++]]=7&c,c>>>=3,h-=3}for(;i.have<19;)i.lens[Ae[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Se={bits:i.lenbits},ye=x(y,i.lens,0,19,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid code lengths set",i.mode=ce;break}i.have=0,i.mode=te;case te:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(_e<16)c>>>=me,h-=me,i.lens[i.have++]=_e;else{if(16===_e){for(Ee=me+2;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c>>>=me,h-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=ce;break}xe=i.lens[i.have-1],m=3+(3&c),c>>>=2,h-=2}else if(17===_e){for(Ee=me+3;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=3+(7&c),c>>>=3,h-=3}else{for(Ee=me+7;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=11+(127&c),c>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ce;break}for(;m--;)i.lens[i.have++]=xe}}if(i.mode===ce)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ce;break}if(i.lenbits=9,Se={bits:i.lenbits},ye=x(S,i.lens,0,i.nlen,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid literal/lengths set",i.mode=ce;break}if(i.distbits=6,i.distcode=i.distdyn,Se={bits:i.distbits},ye=x(E,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Se),i.distbits=Se.bits,ye){e.msg="invalid distances set",i.mode=ce;break}if(i.mode=ie,t===A)break e;case ie:i.mode=ne;case ne:if(f>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,p(e,w),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(ke&&0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.lencode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,i.length=_e,0===ke){i.mode=fe;break}if(32&ke){i.back=-1,i.mode=X;break}if(64&ke){e.msg="invalid literal/length code",i.mode=ce;break}i.extra=15&ke,i.mode=ae;case ae:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=re;case re:for(;Be=i.distcode[c&(1<<i.distbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.distcode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,64&ke){e.msg="invalid distance code",i.mode=ce;break}i.offset=_e,i.extra=15&ke,i.mode=oe;case oe:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ce;break}i.mode=se;case se:if(0===l)break e;if(m=w-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ce;break}m>i.wnext?(m-=i.wnext,k=i.wsize-m):k=i.wnext-m,m>i.length&&(m=i.length),we=i.window}else we=r,k=s-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do r[s++]=we[k++];while(--m);0===i.length&&(i.mode=ne);break;case fe:if(0===l)break e;r[s++]=i.length,l--,i.mode=ne;break;case le:if(i.wrap){for(;h<32;){if(0===f)break e;f--,c|=a[o++]<<h,h+=8}if(w-=l,e.total_out+=w,i.total+=w,w&&(e.adler=i.check=i.flags?v(i.check,r,w,s-w):g(i.check,r,w,s-w)),w=l,(i.flags?c:n(c))!==i.check){e.msg="incorrect data check",i.mode=ce;break}c=0,h=0}i.mode=de;case de:if(i.wrap&&i.flags){for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ce;break}c=0,h=0}i.mode=ue;case ue:ye=R;break e;case ce:ye=O;break e;case he:return I;case be:default:return C}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,(i.wsize||w!==e.avail_out&&i.mode<ce&&(i.mode<le||t!==B))&&u(e,e.output,e.next_out,w-e.avail_out)?(i.mode=he,I):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,i.total+=w,i.wrap&&w&&(e.adler=i.check=i.flags?v(i.check,r,w,e.next_out-w):g(i.check,r,w,e.next_out-w)),e.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===ie||i.mode===Q?256:0),(0===b&&0===w||t===B)&&ye===z&&(ye=T),ye)}function h(e){if(!e||!e.state)return C;var t=e.state;return t.window&&(t.window=null),e.state=null,z}function b(e,t){var i;return e&&e.state?(i=e.state,0===(2&i.wrap)?C:(i.head=t,t.done=!1,z)):C}function w(e,t){var i,n,a,r=t.length;return e&&e.state?(i=e.state,0!==i.wrap&&i.mode!==G?C:i.mode===G&&(n=1,n=g(n,t,r,0),n!==i.check)?O:(a=u(e,t,r,r))?(i.mode=he,I):(i.havedict=1,z)):C}var m,k,_=e("../utils/common"),g=e("./adler32"),v=e("./crc32"),p=e("./inffast"),x=e("./inftrees"),y=0,S=1,E=2,B=4,Z=5,A=6,z=0,R=1,N=2,C=-2,O=-3,I=-4,T=-5,U=8,D=1,F=2,L=3,H=4,M=5,j=6,K=7,P=8,Y=9,q=10,G=11,X=12,W=13,J=14,Q=15,V=16,$=17,ee=18,te=19,ie=20,ne=21,ae=22,re=23,oe=24,se=25,fe=26,le=27,de=28,ue=29,ce=30,he=31,be=32,we=852,me=592,ke=15,_e=ke,ge=!0;i.inflateReset=o,i.inflateReset2=s,i.inflateResetKeep=r,i.inflateInit=l,i.inflateInit2=f,i.inflate=c,i.inflateEnd=h,i.inflateGetHeader=b,i.inflateSetDictionary=w,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,i){"use strict";var n=e("../utils/common"),a=15,r=852,o=592,s=0,f=1,l=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,b,w,m,k,_){var g,v,p,x,y,S,E,B,Z,A=_.bits,z=0,R=0,N=0,C=0,O=0,I=0,T=0,U=0,D=0,F=0,L=null,H=0,M=new n.Buf16(a+1),j=new n.Buf16(a+1),K=null,P=0;for(z=0;z<=a;z++)M[z]=0;for(R=0;R<b;R++)M[t[i+R]]++;for(O=A,C=a;C>=1&&0===M[C];C--);if(O>C&&(O=C),0===C)return w[m++]=20971520,w[m++]=20971520,_.bits=1,0;for(N=1;N<C&&0===M[N];N++);for(O<N&&(O=N),U=1,z=1;z<=a;z++)if(U<<=1,U-=M[z],U<0)return-1;if(U>0&&(e===s||1!==C))return-1;for(j[1]=0,z=1;z<a;z++)j[z+1]=j[z]+M[z];for(R=0;R<b;R++)0!==t[i+R]&&(k[j[t[i+R]]++]=R);if(e===s?(L=K=k,S=19):e===f?(L=d,H-=257,K=u,P-=257,S=256):(L=c,K=h,S=-1),F=0,R=0,z=N,y=m,I=O,T=0,p=-1,D=1<<O,x=D-1,e===f&&D>r||e===l&&D>o)return 1;for(var Y=0;;){Y++,E=z-T,k[R]<S?(B=0,Z=k[R]):k[R]>S?(B=K[P+k[R]],Z=L[H+k[R]]):(B=96,Z=0),g=1<<z-T,v=1<<I,N=v;do v-=g,w[y+(F>>T)+v]=E<<24|B<<16|Z|0;while(0!==v);for(g=1<<z-1;F&g;)g>>=1;if(0!==g?(F&=g-1,F+=g):F=0,R++,0===--M[z]){if(z===C)break;z=t[i+k[R]]}if(z>O&&(F&x)!==p){for(0===T&&(T=O),y+=N,I=z-T,U=1<<I;I+T<C&&(U-=M[I+T],!(U<=0));)I++,U<<=1;if(D+=1<<I,e===f&&D>r||e===l&&D>o)return 1;p=F&x,w[p]=O<<24|I<<16|y-m|0}}return 0!==F&&(w[y+F]=z-T<<24|64<<16|0),_.bits=O,0}},{"../utils/common":1}],10:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}],"/lib/inflate.js":[function(e,t,i){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(d[i]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function a(e,t){var i=new n(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function r(e,t){return t=t||{},t.raw=!0,a(e,t)}var o=e("./zlib/inflate"),s=e("./utils/common"),f=e("./utils/strings"),l=e("./zlib/constants"),d=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=Object.prototype.toString;n.prototype.push=function(e,t){var i,n,a,r,d,u,c=this.strm,b=this.options.chunkSize,w=this.options.dictionary,m=!1;if(this.ended)return!1;n=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?c.input=f.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(b),c.next_out=0,c.avail_out=b),i=o.inflate(c,l.Z_NO_FLUSH),i===l.Z_NEED_DICT&&w&&(u="string"==typeof w?f.string2buf(w):"[object ArrayBuffer]"===h.call(w)?new Uint8Array(w):w,i=o.inflateSetDictionary(this.strm,u)),i===l.Z_BUF_ERROR&&m===!0&&(i=l.Z_OK,m=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&i!==l.Z_STREAM_END&&(0!==c.avail_in||n!==l.Z_FINISH&&n!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(a=f.utf8border(c.output,c.next_out),r=c.next_out-a,d=f.buf2string(c.output,a),c.next_out=r,c.avail_out=b-r,r&&s.arraySet(c.output,c.output,a,r,0),this.onData(d)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):n!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),c.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=n,i.inflate=a,i.inflateRaw=r,i.ungzip=a},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")});\n</script>\n<script src="faview.js"></script>';
}function o(e){var t=new Uint8Array(e),i="",n=0,r=0,a=0,o=0;for(t.length>=3&&239===t[0]&&187===t[1]&&191===t[2]&&(n=3);n<t.length;)if(r=t[n],128>r)i+=String.fromCharCode(r),n++;else if(r>191&&224>r){if(n+1>=t.length)throw"UTF-8 Decode failed. Two byte character was truncated.";a=t[n+1],i+=String.fromCharCode((31&r)<<6|63&a),n+=2}else{if(n+2>=t.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";a=t[n+1],o=t[n+2],i+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&o),n+=3}return i}var s=function(){function e(e,t){this.name=e.name,this.width=e.width,this.height=e.height,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.data=e.data,this.deflated=e.deflated,this.tileSet=t}return e.prototype["export"]=function(e,t,i){if(this.deflated&&"binz"!==t)throw new Error("cannot export by '"+t+"' when have the compressed data");if(!this.deflated&&"binz"===t)throw new Error("cannot export by '"+t+"' when have the uncompressed data");switch(e){case"tmx":return this.exportTMX(t,i);case"json":return this.exportJSON(t,i);case"js":return this.exportJS(t,i);case"raw":return this.exportRaw(t)}throw new Error("unknown file format: "+e)},e.prototype.exportRaw=function(e){switch(e){case"csv":return new Blob([r(new Int32Array(this.data),this.width,"\n")],{type:"text/csv; charset=utf-8"});case"bin":return new Blob([this.data],{type:"application/octet-binary"});default:throw new Error("unknown tile format: "+e)}},e.prototype.exportJSON=function(e,t){for(var i=[],n=new Array(this.name.split("\\").length).join("..\\"),r=0;r<this.tileSet.length;++r)t?i.push(this.tileSet[r].getTileSetReference(n)):i.push(this.tileSet[r].getTileSet(n));var a={width:this.width,height:this.height,tilewidth:this.tileWidth,tileheight:this.tileHeight,nextobjectid:1,orientation:"orthogonal",renderorder:"right-down",version:1,propertytypes:{originalwidth:"int",originalheight:"int"},properties:{originalwidth:this.originalWidth,originalheight:this.originalHeight},tilesets:i,layers:[{height:this.height,name:this.name,opacity:1,type:"tilelayer",visible:!0,width:this.width,x:0,y:0}]};switch(e){case"csv":a.layers[0].data=Array.prototype.slice.call(new Int32Array(this.data));break;case"bin":a.layers[0].encoding="base64",a.layers[0].data=o(c.encode(this.data));break;case"binz":a.layers[0].encoding="base64",a.layers[0].compression="zlib",a.layers[0].data=o(c.encode(this.data));break;default:throw new Error("unknown tile format: "+e)}return new Blob([JSON.stringify(a)],{type:"application/json; charset=utf-8"})},e.prototype.exportJS=function(e,t){return new Blob(["(function(name,data){\n if(typeof onTileMapLoaded === 'undefined') {\n  if(typeof TileMaps === 'undefined') TileMaps = {};\n  TileMaps[name] = data;\n } else {\n  onTileMapLoaded(name, data);\n }})(",JSON.stringify(this.name),", ",this.exportJSON(e,t),");"],{type:"text/javascript; charset=utf-8"})},e.prototype.exportTMX=function(e,t){for(var i=['<?xml version="1.0" encoding="UTF-8"?>\n','<map version="1.0" orientation="orthogonal" renderorder="right-down"',' width="'+this.width+'" height="'+this.height+'"',' tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'" nextobjectid="1">\n',"	<properties>\n",'		<property name="originalWidth" type="int" value="'+this.originalWidth+'"/>\n','		<property name="originalHeight" type="int" value="'+this.originalHeight+'"/>\n',"	</properties>\n"],a=new Array(this.name.split("\\").length).join("..\\"),o=0;o<this.tileSet.length;++o)t?i.push("	"+this.tileSet[o].getTileSetReferenceTag(a)+"\n"):i.push("	"+this.tileSet[o].getTileSetTag(a)+"\n");switch(i.push('	<layer name="'+this.name+'" width="'+this.width+'" height="'+this.height+'">\n'),e){case"csv":i.push('		<data encoding="csv">\n'),i.push(r(new Int32Array(this.data),this.width,",\n"));break;case"xml":i.push("		<data>\n"),i.push(n(new Int32Array(this.data),"			","\n"));break;case"bin":i.push('		<data encoding="base64">\n			'),i.push(c.encode(this.data));break;case"binz":i.push('		<data encoding="base64" compression="zlib">\n			'),i.push(c.encode(this.data));break;default:throw new Error("unknown tile format: "+e)}return i.push("\n		</data>\n	</layer>\n</map>"),new Blob(i,{type:"text/xml; charset=utf-8"})},e}();i.Image=s;var l=function(){function e(e,t,i){this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.tileCount=e.tileCount,this.columns=e.columns,this.width=e.width,this.height=e.height,this.data=e.data,this.gid=t,this.filename=i}return e.prototype.getImage=function(e){var t=new Uint8Array(this.data),i=Math.sqrt(t.length>>2),n=e.createElement("canvas");n.width=i,n.height=i;var r=n.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D");for(var a=r.createImageData(i,i),o=a.data,s=4*i,l=4*a.width,d=0;i>d;++d)for(var c=d*s,h=d*l,u=0;s>u;++u)o[h+u]=t[c+u];return r.putImageData(a,0,0),n},e.prototype["export"]=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n<tileset name="'+this.filename+'" tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'" tilecount="'+this.tileCount+'" columns="'+this.columns+'">\n   <image source="'+this.filename+'.png" width="'+this.width+'" height="'+this.height+'"/>\n</tileset>'},e.prototype.getTileSetReferenceTag=function(e){return'<tileset firstgid="'+this.gid+'" source="'+e+this.filename+'.tsx"/>'},e.prototype.getTileSetTag=function(e){return'<tileset firstgid="'+this.gid+'" name="'+this.filename+'"'+(' tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'"')+(' tilecount="'+this.tileCount+'" columns="'+this.columns+'">')+('<image source="'+e+this.filename+'.png" width="'+this.width+'" height="'+this.height+'"/>')+"</tileset>"},e.prototype.getTileSetReference=function(e){return{firstgid:this.gid,source:e+this.filename+".tsx"}},e.prototype.getTileSet=function(e){return{columns:this.columns,firstgid:this.gid,image:e+this.filename+".png",imageheight:this.height,imagewidth:this.width,margin:0,name:this.filename,spacing:0,tilecount:this.tileCount,tileheight:this.tileHeight,tilewidth:this.tileWidth}},e}();i.Tsx=l;var d=function(){function e(){var e=this;this.queue=[],this.tileSet=[],this.gid=1,this.w=new Worker("/js/tileder.js"),this.w.onmessage=function(t){return e.onMessage(t)}}return e.prototype.onMessage=function(e){switch(e.data.type){case"add":this.onAdd();break;case"tsx":this.onTsx(e.data.t,e.data.i,e.data.n);break;case"image":this.onImage(e.data.img,e.data.i,e.data.n);break;default:throw new Error("unknown message: "+e.data.type)}},e.prototype.add=function(e,t,i){var n;if(t instanceof HTMLImageElement){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,n=r.getContext("2d"),n&&n.drawImage(t,0,0)}else n=t.getContext("2d");if(!n)throw new Error("cannot get CanvasRenderingContext2D");var a=n.getImageData(0,0,n.canvas.width,n.canvas.height),o=this.queue.length>5;o?this.queue.push(i):(this.queue.push(void 0),setTimeout(i,0)),this.w.postMessage({type:"add",n:e,b:a.data.buffer,w:n.canvas.width,h:n.canvas.height},[a.data.buffer])},e.prototype.onAdd=function(){var e=this.queue.shift();e&&setTimeout(e,0)},e.prototype.finish=function(e,t,i,n){this.tsxHandler=t,this.imageHandler=i,this.completeHandler=n,this.w.postMessage({type:"finish",c:e}),this.tileSet=[],this.gid=1},e.prototype.onTsx=function(e,t,i){var n=new l(e,this.gid,t.toString());this.tileSet.push(n),this.gid+=e.tileCount,this.tsxHandler(n,t/i)},e.prototype.onImage=function(e,t,i){var n=new s(e,this.tileSet);this.imageHandler(n,t/i),t===i-1&&this.completeHandler()},e}();i.Tileder=d,i.getViewer=a;var c=function(){function e(){}return e.encode=function(t){for(var i,n=new Uint8Array(t),r=n.byteLength,a=r%3,o=r-a,s=e.table,l=new Uint8Array(o/3*4+(a?4:0)),d=-1,c=0;o>c;c+=3)i=n[c]<<16|n[c+1]<<8|n[c+2],l[++d]=s[(16515072&i)>>18],l[++d]=s[(258048&i)>>12],l[++d]=s[(4032&i)>>6],l[++d]=s[63&i];return 1===a?(i=n[o],l[++d]=s[(252&i)>>2],l[++d]=s[(3&i)<<4],l[++d]=61,l[++d]=61):2===a&&(i=n[o]<<8|n[o+1],l[++d]=s[(64512&i)>>10],l[++d]=s[(1008&i)>>4],l[++d]=s[(15&i)<<2],l[++d]=61),l.buffer},e.table=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47]),e}()},{}],9:[function(e,t,i){"use strict";var n=e("./crc32"),r="zipper",a="file",o=function(){function e(){this.id=Date.now().toString()+Math.random().toString().substring(2),this.fileInfos=[]}return e.prototype.init=function(e,t){var i=this,n=indexedDB.open(r,2);n.onupgradeneeded=function(e){var t=n.result;if(t instanceof IDBDatabase){try{t.deleteObjectStore(a)}catch(e){}return void t.createObjectStore(a)}throw new Error("req.result is not IDBDatabase")},n.onerror=function(e){return t(e)},n.onsuccess=function(t){var r=n.result;if(r instanceof IDBDatabase)return i.db=r,i.gc(function(e){}),void e();throw new Error("req.result is not IDBDatabase")}},e.prototype.dispose=function(e){this.db.onerror=e;var t=this.db.transaction(a,"readwrite");t.onerror=e;var i=t.objectStore(a);this.remove(i,this.id,e),this.gc(function(e){})},e.prototype.gc=function(e){var t=this;if(this.db){this.db.onerror=e;var i=this.db.transaction(a,"readwrite");i.onerror=e;var n=i.objectStore(a),r=n.openCursor(IDBKeyRange.bound("meta_","meta`",!1,!0)),o=(new Date).getTime()-6e4;r.onsuccess=function(i){var a=r.result;if(a&&a instanceof IDBCursorWithValue){if(a.value.lastMod.getTime()<o){var s=a.key;"string"==typeof s&&t.remove(n,s.split("_")[1],e)}return void a["continue"]()}},r.onerror=e}},e.gc=function(){(new e).init(function(){},function(e){})},e.prototype.remove=function(e,t,i){if(this.db){var n=e["delete"](IDBKeyRange.bound("body_"+t+"_","body_"+t+"`",!1,!0));n.onsuccess=function(i){e["delete"]("meta_"+t)}}},e.prototype.add=function(e,t,i,n){this.addCore(e,t,!1,i,n)},e.prototype.addCompress=function(e,t,i,n){this.addCore(e,t,!0,i,n)},e.prototype.addCore=function(e,t,i,n,r){var o=this;if(this.db){var l=this.fileInfos.length,d=new s(e,t,i,function(e){o.db.onerror=r;var t=o.db.transaction(a,"readwrite");t.onerror=r;var i=t.objectStore(a);i.put({lastMod:new Date},"meta_"+o.id);var s=i.put(new Blob([e],{type:"application/octet-binary"}),"body_"+o.id+"_"+l);s.onsuccess=function(e){return n()},s.onerror=r},r);this.fileInfos.push(d)}},e.prototype.generate=function(e,t){var i=this;if(!this.db)throw new Error("Zipper is already disposed");this.db.onerror=t;var n=this.db.transaction(a,"readwrite");n.onerror=t;var r=n.objectStore(a);r.put({lastMod:new Date},"meta_"+this.id),this.receiveFiles(function(t){var n=l.endOfCentralDirectorySize;i.fileInfos.forEach(function(e){n+=e.localFileHeaderSize+e.compressedFileSize+e.centralDirectoryRecordSize}),e(n>4294967295||i.fileInfos.length>65535?i.makeZIP64(t):i.makeZIP(t))},t)},e.prototype.receiveFiles=function(e,t){var i=this,n=this.fileInfos.length,r=new Array(this.fileInfos.length);this.db.onerror=t;var o=this.db.transaction(a,"readonly");o.onerror=t;var s=o.objectStore(a);this.fileInfos.forEach(function(a,o){var l=s.get("body_"+i.id+"_"+o);l.onsuccess=function(t){var i=l.result;i instanceof Blob&&(r[o]=i,--n||e(r))},l.onerror=t})},e.prototype.makeZIP=function(e){var t=[];this.fileInfos.forEach(function(i,n){t.push(i.toLocalFileHeader(),e[n])});var i=0,n=0;return this.fileInfos.forEach(function(e){t.push(e.toCentralDirectoryRecord(i)),i+=e.compressedFileSize+e.localFileHeaderSize,n+=e.centralDirectoryRecordSize}),t.push(l.buildEndOfCentralDirectory(this.fileInfos.length,n,i)),new Blob(t,{type:"application/zip"})},e.prototype.makeZIP64=function(e){var t=[],i=0;this.fileInfos.forEach(function(n,r){t.push(n.toLocalFileHeader64(i),e[r]),i+=n.compressedFileSize+n.localFileHeaderSize64}),i=0;var n=0;return this.fileInfos.forEach(function(e){t.push(e.toCentralDirectoryRecord64(i)),i+=e.compressedFileSize+e.localFileHeaderSize64,n+=e.centralDirectoryRecordSize64}),t.push(d.buildEndOfCentralDirectory(this.fileInfos.length,n,i)),new Blob(t,{type:"application/zip"})},e}();i.Zipper=o;var s=function(){function e(e,t,i,r,a){var o=this;this.date=new Date;var s=2;this.size=t.size,this.compressedSize=t.size,i?(this.compressionMethod=8,++s):this.compressionMethod=0;var d,c=new FileReader;c.onload=function(e){var t=c.result;if(t instanceof ArrayBuffer){if(d=t,o.crc=n.crc32(t),!--s)return void r(d);i&&l.deflate(t,function(e){d=e,o.compressedSize=e.byteLength,--s||r(d)})}},c.onerror=function(e){return a(c.error)},c.readAsArrayBuffer(t);var h=new FileReader;h.onload=function(e){var t=h.result;t instanceof ArrayBuffer&&(o.name=t,--s||r(d))},h.onerror=function(e){return a(h.error)},h.readAsArrayBuffer(new Blob([e]))}return Object.defineProperty(e.prototype,"fileSize",{get:function(){return this.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedFileSize",{get:function(){return this.compressedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localFileHeaderSize",{get:function(){return l.calcLocalFileHeaderSize(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localFileHeaderSize64",{get:function(){return d.calcLocalFileHeaderSize(this.name)},enumerable:!0,configurable:!0}),e.prototype.toLocalFileHeader=function(){return l.buildLocalFileHeader(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize)},e.prototype.toLocalFileHeader64=function(e){return d.buildLocalFileHeader(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},Object.defineProperty(e.prototype,"centralDirectoryRecordSize",{get:function(){return l.calcCentralDirectoryRecordSize(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centralDirectoryRecordSize64",{get:function(){return d.calcCentralDirectoryRecordSize(this.name)},enumerable:!0,configurable:!0}),e.prototype.toCentralDirectoryRecord=function(e){return l.buildCentralDirectoryRecord(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},e.prototype.toCentralDirectoryRecord64=function(e){return d.buildCentralDirectoryRecord(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},e}(),l=function(){function e(){}return e.calcLocalFileHeaderSize=function(e){return 30+e.byteLength+9+e.byteLength},e.buildLocalFileHeader=function(t,i,r,a,o,s){var l=e.formatDate(r),d=new ArrayBuffer(30),c=new ArrayBuffer(9),h=new DataView(d);return h.setUint32(0,67324752,!0),h.setUint16(4,10,!0),h.setUint16(6,2048,!0),h.setUint16(8,a,!0),h.setUint16(10,65535&l,!0),h.setUint16(12,l>>>16&65535,!0),h.setUint32(14,i,!0),h.setUint32(18,s,!0),h.setUint32(22,o,!0),h.setUint16(26,t.byteLength,!0),h.setUint16(28,c.byteLength+t.byteLength,!0),h=new DataView(c),h.setUint16(0,28789,!0),h.setUint16(2,5+t.byteLength,!0),h.setUint8(4,1),h.setUint32(5,n.crc32(t),!0),new Blob([d,t,c,t])},e.calcCentralDirectoryRecordSize=function(e){return 46+e.byteLength+9+e.byteLength},e.buildCentralDirectoryRecord=function(t,i,r,a,o,s,l){var d=e.formatDate(r),c=new ArrayBuffer(46),h=new ArrayBuffer(9),u=new DataView(c);return u.setUint32(0,33639248,!0),u.setUint16(4,20,!0),u.setUint16(6,10,!0),u.setUint16(8,2048,!0),u.setUint16(10,a,!0),u.setUint16(12,65535&d,!0),u.setUint16(14,d>>>16&65535,!0),u.setUint32(16,i,!0),u.setUint32(20,s,!0),u.setUint32(24,o,!0),u.setUint16(28,t.byteLength,!0),u.setUint16(30,h.byteLength+t.byteLength,!0),u.setUint16(32,0,!0),u.setUint16(34,0,!0),u.setUint16(36,0,!0),u.setUint32(38,0,!0),u.setUint32(42,l,!0),u=new DataView(h),u.setUint16(0,28789,!0),u.setUint16(2,5+t.byteLength,!0),u.setUint8(4,1),u.setUint32(5,n.crc32(t),!0),new Blob([c,t,h,t])},e.formatDate=function(e){e||(e=new Date);var t=e.getFullYear()-1980<<9|e.getMonth()+1<<5|e.getDate(),i=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()/2;return t<<16|i},Object.defineProperty(e,"endOfCentralDirectorySize",{get:function(){return 22},enumerable:!0,configurable:!0}),e.buildEndOfCentralDirectory=function(e,t,i){var n=new ArrayBuffer(22),r=new DataView(n);return r.setUint32(0,101010256,!0),r.setUint16(4,0,!0),r.setUint16(6,0,!0),r.setUint16(8,e,!0),r.setUint16(10,e,!0),r.setUint32(12,t,!0),r.setUint32(16,i,!0),r.setUint16(20,0,!0),new Blob([n])},e.deflate=function(t,i){e.worker||(e.worker=new Worker(e.createWorkerURL()),e.worker.onmessage=function(t){var i=e.compressQueue.shift();i&&i(t.data)}),e.compressQueue.push(i),e.worker.postMessage(t,[t])},e.createWorkerURL=function(){return e.workerURL?e.workerURL:(e.workerURL=URL.createObjectURL(new Blob(["\n'use strict';\nimportScripts('https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.3/pako_deflate.min.js');\nonmessage = function(e){\n   var b = pako.deflateRaw(e.data).buffer;\n   postMessage(b, [b]);\n}\n"],{type:"text/javascript"})),e.workerURL)},e.compressQueue=[],e}(),d=function(){function e(){}return e.calcLocalFileHeaderSize=function(e){return 30+e.byteLength+32+9+e.byteLength},e.buildLocalFileHeader=function(t,i,r,a,o,s,l){var d=e.formatDate(r),c=new ArrayBuffer(30),h=new ArrayBuffer(32),u=new ArrayBuffer(9),f=new DataView(c);return f.setUint32(0,67324752,!0),f.setUint16(4,45,!0),f.setUint16(6,2048,!0),f.setUint16(8,a,!0),f.setUint16(10,65535&d,!0),f.setUint16(12,d>>>16&65535,!0),f.setUint32(14,i,!0),f.setUint32(18,4294967295,!0),f.setUint32(22,4294967295,!0),f.setUint16(26,t.byteLength,!0),f.setUint16(28,h.byteLength+u.byteLength+t.byteLength,!0),f=new DataView(h),f.setUint16(0,1,!0),f.setUint16(2,28,!0),e.setUint64(f,4,o),e.setUint64(f,12,s),e.setUint64(f,20,l),f.setUint32(28,0),f=new DataView(u),f.setUint16(0,28789,!0),f.setUint16(2,5+t.byteLength,!0),f.setUint8(4,1),f.setUint32(5,n.crc32(t),!0),new Blob([c,t,h,u,t])},e.calcCentralDirectoryRecordSize=function(e){return 46+e.byteLength+32+9+e.byteLength},e.buildCentralDirectoryRecord=function(t,i,r,a,o,s,l){var d=e.formatDate(r),c=new ArrayBuffer(46),h=new ArrayBuffer(32),u=new ArrayBuffer(9),f=new DataView(c);return f.setUint32(0,33639248,!0),f.setUint16(4,45,!0),f.setUint16(6,45,!0),f.setUint16(8,2048,!0),f.setUint16(10,a,!0),f.setUint16(12,65535&d,!0),f.setUint16(14,d>>>16&65535,!0),f.setUint32(16,i,!0),f.setUint32(20,4294967295,!0),f.setUint32(24,4294967295,!0),f.setUint16(28,t.byteLength,!0),f.setUint16(30,h.byteLength+u.byteLength+t.byteLength,!0),f.setUint16(32,0,!0),f.setUint16(34,65535,!0),f.setUint16(36,0,!0),f.setUint32(38,0,!0),f.setUint32(42,4294967295,!0),f=new DataView(h),f.setUint16(0,1,!0),f.setUint16(2,28,!0),e.setUint64(f,4,o),e.setUint64(f,12,s),e.setUint64(f,20,l),f.setUint32(28,0),f=new DataView(u),f.setUint16(0,28789,!0),f.setUint16(2,5+t.byteLength,!0),f.setUint8(4,1),f.setUint32(5,n.crc32(t),!0),new Blob([c,t,h,u,t])},e.formatDate=function(e){e||(e=new Date);var t=e.getFullYear()-1980<<9|e.getMonth()+1<<5|e.getDate(),i=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()/2;return t<<16|i},Object.defineProperty(e,"endOfCentralDirectorySize",{get:function(){return 98},enumerable:!0,configurable:!0}),e.buildEndOfCentralDirectory=function(t,i,n){var r=new ArrayBuffer(22),a=new ArrayBuffer(56),o=new ArrayBuffer(20),s=new DataView(a);return s.setUint32(0,101075792,!0),e.setUint64(s,4,a.byteLength+o.byteLength+r.byteLength-12),s.setUint16(12,45,!0),s.setUint16(14,45,!0),s.setUint32(16,0,!0),s.setUint32(20,0,!0),e.setUint64(s,24,t),e.setUint64(s,32,t),e.setUint64(s,40,i),e.setUint64(s,48,n),s=new DataView(o),s.setUint32(0,117853008,!0),s.setUint32(4,0,!0),e.setUint64(s,8,n+i),s.setUint32(16,1,!0),s=new DataView(r),s.setUint32(0,101010256,!0),s.setUint16(4,65535,!0),s.setUint16(6,65535,!0),s.setUint16(8,65535,!0),s.setUint16(10,65535,!0),s.setUint32(12,4294967295,!0),s.setUint32(16,4294967295,!0),s.setUint16(20,0,!0),new Blob([a,o,r])},e.setUint64=function(e,t,i){e.setUint32(t,4294967295&i,!0),e.setUint32(t+4,Math.floor(i/4294967296),!0)},e}();o.gc()},{"./crc32":2}]},{},[6]);
